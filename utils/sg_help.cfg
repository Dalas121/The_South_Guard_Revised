#textdomain wesnoth-tsg



#define TUTORIAL_ENABLE_CONDITION
    #
    [filter_condition]
        [variable]
            name=enable_tutorial_elements
            equals=yes
        [/variable]
    [/filter_condition]
#enddef







#######################################################################################################################################################
#                                                                     HELPER MACROS
#######################################################################################################################################################
#define TUTORIAL_ARROW X Y
    [item]
        name=arrow
        x,y={X},{Y}
        image=misc/highlight-hex.png
        halo=misc/arrow[10~19,20~11].png
    [/item]
#enddef
#define REMOVE_ARROW
    [remove_item]
        name=arrow
    [/remove_item]
#enddef

#define UNDO_REMINDER
    [message]
        speaker=narrator
        caption= _"Undo"
        image=wesnoth-icon.png
        message= _"Press “u” if you need to undo a move. Attacks cannot be undone."
    [/message]
    [cancel_action][/cancel_action]
    [allow_undo][/allow_undo]
#enddef

#define TALK_ABOUT ID_STRING MESSAGE_TEXT
    [scroll_to_unit]
        id={ID_STRING}
        highlight=yes
    [/scroll_to_unit]
    [message]
        id=Mari,Sir Gerrick,Minister Hylas
        scroll=no
        highlight=no
        message={MESSAGE_TEXT}
    [/message]
#enddef

#define TALK_ABOUT_LOC POSITION MESSAGE_TEXT
    [scroll_to]
        x,y={POSITION}
        highlight=yes
    [/scroll_to]
    [message]
        id=Mari,Sir Gerrick,Minister Hylas
        scroll=no
        highlight=no
        message={MESSAGE_TEXT}
    [/message]
#enddef





#######################################################################################################################################################
#                                                                  EXPLAIN ADVANCEMENTS
#######################################################################################################################################################
#############################
# GENERIC ADVANCEMENTS
#############################
#define EXPLAIN_GENERIC_ADVANCEMENT VAR FLT MESSAGE
    [event]
        name=post_advance
        {FILTER side,type=1,{FLT}}
        {FILTER_CONDITION( {VARIABLE_CONDITIONAL sg_advancement_{VAR} not_equals yes} )}
        {TUTORIAL_ENABLE_CONDITION}
        [message]
            speaker=unit
            message={MESSAGE}
        [/message]
        {VARIABLE sg_advancement_{VAR} yes}
    [/event]
#enddef
{EXPLAIN_GENERIC_ADVANCEMENT sword Swordsman       _"Advancing a level has fully healed me! I am now particularly good with the sword, dealing 8 damage for 4 strikes."}
{EXPLAIN_GENERIC_ADVANCEMENT pike  Pikeman         _"Advancing a level has fully healed me! I now have a powerful pike attack, dealing 10 damage for 3 strikes, with the <b><i>first strike</i></b> weapon special."}
{EXPLAIN_GENERIC_ADVANCEMENT jav   Javelineer      _"Advancing a level has fully healed me! I have both powerful melee and ranged attacks and am a versatile mixed fighter in combat. My experience bar is now purple, indicating that I cannot advance any further."}
{EXPLAIN_GENERIC_ADVANCEMENT bow   Longbowman      _"Advancing a level has fully healed me! My ranged bow attack is now much more powerful, dealing 10 damage for 3 strikes."}
{EXPLAIN_GENERIC_ADVANCEMENT duel  Duelist         _"Advancing a level has fully healed me! I am now more deadly in melee, and have gained a weak ranged attack."}
{EXPLAIN_GENERIC_ADVANCEMENT shock "Shock Trooper" _"Advancing a level has fully healed me! I am now more deadly in melee, dealing 18 damage for 2 strikes."}
{EXPLAIN_GENERIC_ADVANCEMENT redm  "Red Mage"      _"Advancing a level has fully healed me! My magic is now more powerful, dealing 8 damage for 4 strikes, with the <b><i>magical</i></b> weapon special."}
{EXPLAIN_GENERIC_ADVANCEMENT whitm "White Mage"    _"Advancing a level has fully healed me! I can now heal adjacent allies for 8 hitpoints each turn."}

#############################
# DEORAN ADVANCEMENTS
#############################
[event]
    name=post_advance
    {FILTER id,level=Deoran,2}
    {TUTORIAL_ENABLE_CONDITION}
    [message]
        speaker=unit
        message= _ "Advancing a level has fully healed me! I am healthier, faster, stronger, and have also gained a ranged crossbow attack. If you want a detailed description of everything I can do, right click me and select <b>Unit Description</b>."
    [/message]
[/event]
[event]
    name=post_advance
    {FILTER id,level=Deoran,3}
    {TUTORIAL_ENABLE_CONDITION}
    [message]
        speaker=unit
        message= _ "Advancing a level has fully healed me again, and has improved my hitpoints and damage! If you want a detailed description of everything I can do, right click me and select <b>Unit Description</b>."
    [/message]
[/event]

#############################
# COMPANION ADVANCEMENTS
#############################
[event]
    name=post_advance
    {FILTER id,level=Mari,3}
    {TUTORIAL_ENABLE_CONDITION}
    [message]
        speaker=unit
        message= _ "You know what they say, wash away the mental pains with training gains. I’m so big and strong now. No seriously, did you want a detailed description of what I can do after advancing? Right click me and select <b>Unit Description</b> and you can learn everything you want to know."
    [/message]
[/event]
[event]
    name=post_advance
    {FILTER id,level="Sir Gerrick",3}
    {TUTORIAL_ENABLE_CONDITION}
    [message]
        speaker=unit
        message= _ "Practice makes perfect. I have gained enough experience to advance a level, and have become more powerful! If you want a detailed description of everything I can do, right click me and select <b>Unit Description</b>."
    [/message]
[/event]
[event]
    name=post_advance
    {FILTER id,level="Minister Hylas",3}
    {TUTORIAL_ENABLE_CONDITION}
    [message]
        speaker=unit
        message= _ "After much experience battling our foes, I have advanced a level and gained a new ability! If you want a detailed description of everything I can do, right click me and select <b>Unit Description</b>."
    [/message]
[/event]




#######################################################################################################################################################
#                                                                   EXPLAIN TURN LIMIT
#######################################################################################################################################################
[event]
    name=explain_turn_limit
    {TUTORIAL_ENABLE_CONDITION}
    {FILTER_CONDITION( {VARIABLE_CONDITIONAL sg_turns_explained not_equals yes} )}
    [display_tip]
        title=_"Turn Limits"
        image=tutor/turns.png
        message=_"
Most scenarios have a turn limit, as
shown in the upper-left-hand-corner.
Usually, running out of turns will
result in defeat — check your
<i><b>objectives</b></i> by clicking the <i><b>“Menu”</b></i>
button in the top-left corner 
(or use the hotkey <i><b>Ctrl+J</b></i>).
{BR}
Finishing early will usually reward 
a gold boost (“early finish bonus”) 
in the next scenario, so don’t delay!"
    [/display_tip]
    {VARIABLE sg_turns_explained yes}
[/event]





#######################################################################################################################################################
#                                                                  UNITS AND ATTACKS
#######################################################################################################################################################
#############################
# HIGHLIGHT MISSES
#############################
# when I first started Wesnoth, it wasn't always clear why my units wouldn't deal any damage
# hopefully this indicator helps make it a little more clear what's happening
# (and hopefully this doesn't make other campaigns without this indicator confusing)
[event]
    name=attack misses
    first_time_only=no
    {TUTORIAL_ENABLE_CONDITION}
    [floating_text]
        x,y=$second_unit.x,$second_unit.y
        text=_"Miss"
    [/floating_text]
[/event]

#############################
# HEALERS CAN'T HEAL THEMSELVES
#############################
[event]
    name=new turn
    {TUTORIAL_ENABLE_CONDITION}
    [filter_condition]
        {VARIABLE_CONDITIONAL sg_selfheal_info not_equals yes}
        [have_unit]
            id=Ethiliel,Hylas
            formula=(self.hitpoints < self.max_hitpoints/2)
        [/have_unit]
    [/filter_condition]
    [message]
        id=Ethiliel,Hylas
        formula=(self.hitpoints < self.max_hitpoints/2)
        message=_"My healing magic is potent, but I cannot use it to heal myself. I’ll have to end my turn on a village to recover."
    [/message]
    {VARIABLE sg_selfheal_info yes}
[/event]


#############################
# RANGED ATTACK
#############################
[event]
    name=attack end
    {FILTER side=1}
    {FILTER_ATTACK range=ranged}
    {FILTER_SECOND( type_adv_tree=Quintain,Thug,Thief,Walking Corpse,Ghoul,Skeleton )}
    {TUTORIAL_ENABLE_CONDITION}
    {FILTER_CONDITION( {VARIABLE_CONDITIONAL sg_ranged_info not_equals yes} )}
    
    {VARIABLE sg_ranged_info yes}
    [message]
        speaker=unit
        message=_"I just made a <i><b>ranged attack</b></i>! I had to stand right next to this $second_unit.type <i>(yes, this is different from how most games handle ranged attacks)</i>, but because the $second_unit.type has no ranged weapon of his own he was unable to retaliate."
    [/message]
[/event]


#############################
# UNIT TYPES
#############################
#define EXPLAIN_UNIT_TYPE VAR FLT IMAGE MESSAGE
    [event]
        name=moveto
        {FILTER_CONDITION({HAVE_UNIT( side=1 {FILTER_ADJACENT {FLT}} )})}
        {TUTORIAL_ENABLE_CONDITION}
        {FILTER_CONDITION( {VARIABLE_CONDITIONAL sg_{VAR}_info not_equals yes} )}
        
        {VARIABLE sg_{VAR}_info yes}
        [message]
            speaker=narrator
            image={IMAGE}
            {TUTOR: {MESSAGE}}
        [/message]
    [/event]
#enddef

{EXPLAIN_UNIT_TYPE
    thug  type_adv_tree=Thug
    "units/human-outlaws/thug-melee-3.png~RC(magenta>red)"
    _"Thugs are the mainstay of the bandit rings. They are powerful in melee combat, but do not have a <i>ranged</i> attack and are vulnerable to archers. Like all outlaw units, they are much more dangerous at night due to having the <b>chaotic</b> alignment."
}
{EXPLAIN_UNIT_TYPE
    thief  type_adv_tree=Thief
    "units/human-outlaws/thief-defend-2-2.png~RC(magenta>red)"
    _"Thieves are weak in one-on-one combat, but can be deadly if you allow them to surround your units. On offense, thieves will deal double damage when they have an ally directly behind the unit they are attacking! Like thugs, thieves are vulnerable to ranged attacks."
}
{EXPLAIN_UNIT_TYPE
    footpad  type_adv_tree=Footpad
    "units/human-outlaws/footpad+female-attack1.png~RC(magenta>red)"
    _"Footpads are the scouts of the bandit rings. They are highly mobile, and have both a <i>melee</i> attack and a <i>ranged</i> attack, although neither of their attacks is very strong. Footpads are difficult to hit with regular attacks, but will take bonus damage from <i>blade</i>, <i>impact</i>, or <i>pierce</i> weapons and can be easily killed during the day."
}
{EXPLAIN_UNIT_TYPE
    corpse  type_adv_tree="Walking Corpse"
    "units/undead/zombie-attack-s.png~RC(magenta>red)"
    _"Walking corpses are usually used by weaker practitioners of the black arts, who pilfer dead bodies to practice their profane magic. Alone, they are slow and weak, although they can become dangerous in large groups. Any unit slain by a Walking Corpse will be plagued with undeath and become one as well."
}
# {EXPLAIN_UNIT_TYPE
#     ghoul  type_adv_tree=Ghoul
#     "units/undead/ghoul-attack-3.png~RC(magenta>red)"
#     _"Ghouls are abominations of flesh with considerable durability and festering with disease. While their raw damage output is low, their <i>poison</i> attacks can cripple your units. <i><b>Use healers or villages to cure poison!</b></i>"
# }
{EXPLAIN_UNIT_TYPE
    skeleton  type_adv_tree=Skeleton,"Skeleton Archer"
    "units/undead-skeletal/skeleton/skeleton-se-melee2.png~RC(magenta>red)"
    _"Skeletons are the bones of fallen warriors reanimated by dark sorcery. They are almost immune to <i>pierce</i> weapons like arrows and spears, but are especially vulnerable to <i>impact</i> weapons. Like bandits, they are much more dangerous at night!"
}


[event]
    name=moveto
    {FILTER_CONDITION({HAVE_UNIT( side=1 {FILTER_ADJACENT type_adv_tree=Ghoul} )})}
    {FILTER_CONDITION( {VARIABLE_CONDITIONAL sg_ghoul_info not_equals yes} )}
    
    {VARIABLE sg_ghoul_info yes}
    [message]
        speaker=Deoran
        message= _ "What manner of undeath have you inflicted upon this poor elf! This is even worse than the walking corpses we’ve already fought, if such a thing is possible."
    [/message]
    [message]
        speaker=Urza Nalmath
        message= _ "Undeath!? You offend me, good sir — this lovely lady is still alive... although come to think of it, she might wish she weren’t. Look at her supple body; listen to her alluring voice. Isn’t she charming?"
    [/message]
    [message]
        type=Ghoul {FILTER_ADJACENT id=$unit.id}
        message= _ "Graaahhh..."
    [/message]
    {SAY_COMPANION
        MESSAGE_MARI=_"Just what we needed: ghouls. I’ve fought these things before, and I don’t miss the smell. But the worst part is their claws — one scratch and you’ll be poisoned until healed at a village, or by a healer like Ethiliel."
        MESSAGE_GERRICK=_"By Haldric, they’re real! The old-timers used to talk about fighting bloated, half-dead, half-alive “ghouls”... they say it takes but one scratch to poison a man half-dead, unless healed at a village or by a healer like Ethiliel."
        MESSAGE_HYLAS=_"A most putrid creation: ghouls. The corruption is spreading; we must act carefully. Be wary of their claws, Deoran — one scratch and you’ll be poisoned until healed at a village, or by a healer like me and Ethiliel."
    }
    [if] {VARIABLE_CONDITIONAL enable_tutorial_elements equals yes}
        [then]
            [display_tip]
                title=_"Poison"
                image=tutor/poison.png
                message=_"Ghouls inflict <i><b>poison</b></i> whenever they
damage one of your units. A poisioned
unit will lose <i><b>8 hitpoints</b></i> at the start
of every turn. Poison can never kill a unit,
but it can reduce them to 1 hitpoint!

Receiving healing from a village or
a healer (such as Ethiliel) will also
<i><b>cure poison.</b></i>"
            [/display_tip]
        [/then]
    [/if]
[/event]


[event]
    name=attack_end
    {FILTER side=1}
    {FILTER_ATTACK type=pierce}
    {FILTER_SECOND type_adv_tree=Skeleton,Skeleton Archer}
    {FILTER_CONDITION( {VARIABLE_CONDITIONAL sg_pierce_info not_equals yes} )}
    {FILTER_CONDITION( {VARIABLE_CONDITIONAL second_unit.hitpoints greater_than 0} )}
    {TUTORIAL_ENABLE_CONDITION}
    
    {VARIABLE sg_pierce_info yes}
    [message]
        speaker=unit
        message= _ "Our bows and spears are nearly useless against these skeletons! They have nothing for our shafts to pierce but air!"
    [/message]
    [message]
        speaker=Deoran
        message= _ "If I want to see what damage resistances and vulnerabilities a unit has, I should right-click it and select “Unit Description.”"
    [/message]
[/event]





#######################################################################################################################################################
#                                                                EXPERIENCE AND VETERANS
#######################################################################################################################################################
#############################
# UNIT IS CLOSE TO LEVELING
#############################
[event]
    name=attack end
    {FILTER canrecruit=no} # don't trigger this when fighting enemies who're likely to have death events
    [filter_second]
        side,formula=1,"if( (self.experience+8)>=self.max_experience and self.experience<self.max_experience, 1, 0 )"
    [/filter_second]
    {TUTORIAL_ENABLE_CONDITION}
    {FILTER_CONDITION( {VARIABLE_CONDITIONAL sg_high_xp_info not_equals yes} )}
    
    [message]
        speaker=second_unit
        message=_"Good work, commander! Under your command I’ve defeated many enemies, and now have $second_unit.experience|xp."
    [/message]
    [message]
        speaker=second_unit
        message=_"If you can keep me safe and get me up to $second_unit.max_experience|xp, I’ll advance to a higher level, and become much more powerful!"
    [/message]
    [display_tip]
        title=_"Feeding Experience"
        image=tutor/feeding_experience.png
        message=_"Level-2 and -3 units are very powerful,
but difficult to obtain.
{BR}
After each attack, a units gains
experience equal to the level of their
enemy. If they <b>kill their enemy</b>, they 
gain <b>8x as much xp</b>! <i>(or 4xp for killing a
level-0 enemy)</i>
{BR}
Take good care of your high-experience
level-1 units. Keep them healthy and 
feed them kills, so they eventually
gain enough experience to advance!"
    [/display_tip]
    {VARIABLE sg_high_xp_info yes}
[/event]


#############################
# HIGH-XP UNIT DIES
#############################
[event]
    name=last breath
    [filter]
        side,formula=1,"if( (self.experience+8)>=self.max_experience and self.experience<self.max_experience, 1, 0 )"
        {OR( side,level=1,2-99 {NOT canrecruit=yes} {NOT trait=loyal} )} # don't trigger this for units who're likely to have death events
    [/filter]
    {TUTORIAL_ENABLE_CONDITION}
    {FILTER_CONDITION( {VARIABLE_CONDITIONAL sg_veteran_death not_equals yes} )}
    
    [message]
        speaker=unit
        message=_"Alas, I perish! And with me, all my hard-won battle experience is lost."
    [/message]
    {KILL id=$unit.id ANIMATE=yes}
    {SAY_COMPANION
        MESSAGE_GENERIC=_"You will be missed, my veteran friend! If only we had kept him safe, he could have been a valuable asset in our fight."
    }
    {VARIABLE sg_veteran_death yes}
[/event]


# [event]
#     name=prestart
#     {VARIABLE lhpu_msg_i 0}
#     {VARIABLE low_hp_unit_message[0].value ( _ "I hope I have a chance to retreat after this!")}
#     {VARIABLE low_hp_unit_message[1].value ( _ "One unlucky round of attacks and I’m done for!")}
#     {VARIABLE low_hp_unit_message[2].value ( _ "I could make use of some healing in a village.")}
#     {VARIABLE low_hp_unit_message[3].value ( _ "I had better retreat, before I get caught out with such low health!")}
# [/event]
# [event]
#     name=warn_about_units_with_low_health
#     first_time_only=no
#     [filter_condition]
#         [variable]
#             name=unit.hitpoints
#             less_than="$($unit.max_hitpoints/5)"
#         [/variable]
#         [variable]
#             name=unit.hitpoints
#             greater_than=0
#         [/variable]
#         [variable]
#             name=second_unit.hitpoints
#             greater_than=0
#         [/variable]
# 
#         [variable]
#             name=lhpu_msg_i
#             less_than_equal_to=3
#         [/variable]
#     [/filter_condition]
#     {TUTORIAL_ENABLE_CONDITION}
#     [message]
#         speaker=unit
#         message="$low_hp_unit_message[$lhpu_msg_i].value"
#     [/message]
#     {VARIABLE_OP lhpu_msg_i add 1}
#     [message]
#         speaker=Mari
#         message= _ "That unit is about one kill (8 experience points) away from gaining a level. Protect him so he can level up."
#         [show_if]
#             [variable]
#                 name=unit.experience
#                 greater_than=$($unit.max_experience - 8)
#             [/variable]
#         [/show_if]
#     [/message]
# [/event]
# [event]
#     name=victory
#     {CLEAR_VARIABLE lhpu_msg_i,low_hp_unit_message}
# [/event]





#######################################################################################################################################################
#                                                                    RNG AND LUCK
#######################################################################################################################################################
#define NOT_FIRST_MISSION
    {FILTER_CONDITION( {NOT({HAVE_UNIT type=quintain   })} )}
    {FILTER_CONDITION( {NOT({HAVE_UNIT id="Urza Mathin"})} )}
#enddef

#############################
# TRACK HITS-AND-MISSES
#############################
[event]
    name,first_time_only=pre attack,no
    {VARIABLE consecutive_hits 0}
    {VARIABLE consecutive_misses 0}
[/event]
[event]
    name,first_time_only=attacker hits,no
    {VARIABLE_OP consecutive_hits add 1}
[/event]
[event]
    name,first_time_only=attacker misses,no
    {VARIABLE_OP consecutive_misses add 1}
[/event]
[event]
    name=victory
    {CLEAR_VARIABLE consecutive_hits,consecutive_misses}
[/event]

#############################
# PLAYER MISSES ALL STRIKES (EXPECTED)
#############################
# display each of these RNG tips in order - 1, 2, 3, 4. So they're more likely to be spread out across several scenarios
[event]
    name=attack end
    {FILTER side=1} {FILTER_ATTACK({NOT special_id=magical})} {FILTER_SECOND defense=0-40}
    {FILTER_CONDITION( {VARIABLE_CONDITIONAL consecutive_hits equals 0  } )}
    {FILTER_CONDITION( {VARIABLE_CONDITIONAL sg_rnginfo_1 not_equals yes} )}
    {NOT_FIRST_MISSION}{TUTORIAL_ENABLE_CONDITION}
    [message]
        speaker=unit
        message= _ "I missed all $consecutive_misses strikes! I tried my best, but this enemy had high dodge, and I also got unlucky. I might have had better odds attacking a different enemy."
    [/message]
        [message]
        speaker=unit
        message= _ "A good commander understands the odds, and knows how to both exploit good luck and mitigate bad luck. After all, both good and bad luck are equally likely!"
    [/message]
    [display_tip]
        title=_"Managing Luck"
        image=tutor/luck.png
        message=_"Wesnoth is a game about flexible strategy,
not deterministic calculation.
Anyone can win when things go as planned.
Wesnoth’s skill & mastery lie in creating
a strategy that <i><b>mitigates bad luck</b></i>, while
simultaneously <i><b>exploits good luck</b></i>. Both
bad and good luck are inevitable, so be 
ready to handle both!
{BR}
Expert players are so skilled at this that
they can ironman every campaign on even 
the highest difficulty!
{BR}
That said, if you really prefer a more
deterministic experience, try selecting
<i><b>“Reduced RNG”</b></i> when starting a new 
campaign."
    [/display_tip]
    {VARIABLE sg_rnginfo_1 yes}
[/event]

#############################
# PLAYER HITS MANY STRIKES (EXPECTED)
#############################
[event]
    name=attack end
    {FILTER side=1} {FILTER_ATTACK({NOT special_id=magical})} {FILTER_SECOND defense=60-100}
    {FILTER_CONDITION( {VARIABLE_CONDITIONAL consecutive_misses         equals 0  } )}
    {FILTER_CONDITION( {VARIABLE_CONDITIONAL sg_rnginfo_1     equals yes} )}
    {FILTER_CONDITION( {VARIABLE_CONDITIONAL sg_rnginfo_2 not_equals yes} )}
    {NOT_FIRST_MISSION}{TUTORIAL_ENABLE_CONDITION}
    [message]
        speaker=unit
        message= _ "I got lucky and hit all $consecutive_hits strikes! Good luck will sometimes happen, but a good commander knows how to win without relying on it. After all, back luck happens just as often as good luck!"
    [/message]
    {VARIABLE sg_rnginfo_2 yes}
[/event]

#############################
# PLAYER MISSES ALL STRIKES (UNEXPECTED)
#############################
[event]
    name=attack end
    {FILTER side=1} {FILTER_ATTACK({NOT special_id=magical})} {FILTER_SECOND defense=60-100}
    {FILTER_CONDITION( {VARIABLE_CONDITIONAL consecutive_hits         equals 0  } )}
    {FILTER_CONDITION( {VARIABLE_CONDITIONAL sg_rnginfo_2     equals yes} )}
    {FILTER_CONDITION( {VARIABLE_CONDITIONAL sg_rnginfo_3 not_equals yes} )}
    {NOT_FIRST_MISSION}{TUTORIAL_ENABLE_CONDITION}
    [message]
        speaker=unit
        message= _ "I missed all $consecutive_misses strikes, even though my enemy had low dodge! That’s unlucky, but back luck happens just as often as good luck — a good commander knows how to plan around both!"
    [/message]
    {VARIABLE sg_rnginfo_3 yes}
[/event]

#############################
# PLAYER HITS MANY STRIKES (UNEXPECTED)
#############################
[event]
    name=attack end
    {FILTER side=1} {FILTER_ATTACK({NOT special_id=magical})} {FILTER_SECOND defense=0-50}
    {FILTER_CONDITION( {VARIABLE_CONDITIONAL consecutive_hits greater_than_equal_to 3  } )}
    {FILTER_CONDITION( {VARIABLE_CONDITIONAL sg_rnginfo_3     equals yes} )}
    {FILTER_CONDITION( {VARIABLE_CONDITIONAL sg_rnginfo_4 not_equals yes} )}
    {NOT_FIRST_MISSION}{TUTORIAL_ENABLE_CONDITION}
    [message]
        speaker=unit
        message= _ "I hit $consecutive_hits strikes, even though my enemy had high dodge! Luck works both ways — sometimes I miss strikes when I was likely to hit, but sometimes I also hit strikes that I was likely to miss — like now!"
    [/message]
    {VARIABLE sg_rnginfo_4 yes}
[/event]































#define TODO_REIMPLEMENT_THESE_SOMETIME
    #TODO sometime
    [event]
        name=turn 11
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Tracking Unused Units"
            message= _ "You can ensure you use all your troops by pressing <b>n</b> to step from one unit to the next. If you press <b>space</b>, you can mark the currently selected unit as having finished its turn, which stops you moving it by accident later on. When <b>n</b> no longer selects a new unit, it’s safe to end your turn."
        [/hint_message]
    [/event]
    #TODO sometime
    [event]
        name=turn 8
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Support"
            message= _"Each village you control will <i>support</i> one unit for free. After that, each unit costs you one gold per turn." (TODO - Dalas says, also mention higher-level units costing more support)
        [/hint_message]
        [hint_message]
            caption= _ "Income and Upkeep"
            message= _ "Each turn, you will gain 2 gold plus one for each village you own. However, <i>upkeep</i> is subtracted from that. You can support as many levels worth of units as the number of villages you own; beyond that, you must pay 1 gold per turn. Be careful, as owning too many units can cause you to have negative income and lose gold each turn!"
        [/hint_message]
    [/event]
    #TODO sometime
#enddef

#define TSG_TUTORIAL_EVENTS_S3
    [event]
        name=start
        {TUTORIAL_ENABLE_CONDITION}

        [message]
            speaker=Mari
            message= _"If you have eyeballs, I am sure you can tell this thick fog is preventing us from seeing further into the valley. Despite it supposedly being peaceful here, we should take caution as we do not know what may lie behind the fog of war. We probably should recruit a few units just to be prepared."
        [/message]
    [/event]

    [event]
        name=side 1 turn 1
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Fog of War"
            message= _ "This scenario has fog of war, which hides units and ownership of villages outside of your units’ vision. Fog of war is cleared temporarily when you have units nearby, but returns when they leave. Your unit’s movement will be stopped if it sees an enemy unit in the fog of war. Clearing fog of war will prevent you from undoing actions unless you activate <b>Delay Shroud Updates</b> in the actions menu, which prevents units from clearing fog until the next randomized event or turn."
        [/hint_message]
    [/event]

    [event]
        name=select
        [filter]
            id=Ethiliel
        [/filter]
        {TUTORIAL_ENABLE_CONDITION}

        [message]
            speaker=narrator
            image="units/elves-wood/shyde-healing4.png~RC(magenta>green)"
            {TUTOR: _"Ethiliel is a powerful <i>level 3</i> Elvish Shyde capable of healing allied units at the start of every turn. She has powerful ranged attacks: a mighty <i>magical</i> thorns attack and an ensnare attack that <i>slows</i> enemy units, halving their movement and damage dealt. She also has a <i>flying</i> movetype, offering excellent defenses and movement over most terrain and the ability to cross <i>deep water</i>."}
        [/message]
    [/event]

    [event]
        name=turn 4
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Victory Conditions"
            message= _ "Each scenario has different victory conditions, which must be read carefully in order to achieve victory. In this case, in addition to moving to Ethiliel to the marker at (25,28), you must defeat all enemies on the map. This includes finding where they may be hidden in the fog of war."
        [/hint_message]
    [/event]

    [event]
        name=turn 5
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Scouting"
            message= _ "Units with higher movement points such as <i>Cavalrymen</i> or <i>Dragoons</i> can see further into fog of war. They can provide valuable information about the state of the map and where enemies may be lying in wait. Units with flying movetypes, such as Ethiliel, are also useful for scouting."
        [/hint_message]
    [/event]

    [event]
        name=turn 7
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Battle Formation Strategy"
            message= _ "The bandits are scattered around the map and weak individually. You can take advantage of this by keeping your units together in formation. By traveling together and making use of abilities like Mari’s <i>protection</i> or Ethiliel’s <i>heals</i>, you can easily overcome the enemy."
        [/hint_message]
    [/event]

    [event]
        name=turn 11
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Distributing Experience"
            message= _ "In many cases, it is a useful strategy to focus experience onto a couple lower level units in order to advance them to the next level. Once you have enough veterans, you can pair them with fresh recruits and use the veteran to do the bulk of the damage, allowing the new recruit to obtain the last hit to gain it more experience. This can minimize the damage to your army and the losses you take."
        [/hint_message]
    [/event]

    [event]
        name=turn 13
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Keeping Heroes Safe"
            message= _ "Minimizing the risk to your heroes (e.g. Captain Mari or Officer Deoran) is important, as the campaign will be lost if one of them die. However, if they do not obtain enough experience, they will also be too weak to be effective in later scenarios. Striking a balance of minimizing risk and obtaining adequate experrience is important to utilizing your heroes effectively."
        [/hint_message]
    [/event]

    [event]
        name=turn 15
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Early Finish Bonus"
            message= _ "Many scenarios with turn limits offer an early finish bonus, which is a gold bonus greater than the possible income you could obtain from the scenario. However, it is not always beneficial to finish a scenario early if there are remaining enemies you can obtain experience from."
        [/hint_message]
    [/event]

    [event]
        name=turn 17
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            remove=yes
        [/hint_message]
    [/event]
#enddef

#define TSG_TUTORIAL_EVENTS_S4
    [event]
        name=side 1 turn 1
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Shroud"
            message= _ "This scenario has shroud in addition to fog of war. Shroud hides the map and all of its terrain features, but is cleared permanently as your units explore more of the map. Like with fog of war, scouts are particularly effective at exploration and clearing shroud."
        [/hint_message]
    [/event]

    [event]
        name=turn 2
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Safe Shroud Exploration"
            message= _ "Unlike scenarios with only fog of war, you do not know if there will be another opportunity to recruit or recall units in other areas of the map. It may be prudent to first recruit expeditionary forces and begin scouting before moving your leaders away from the starting keep."
        [/hint_message]
    [/event]

    [event]
        name=turn 4
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Using Elves"
            message= _ "You have now gained command of some elvish units. Compared to humans, they have higher defenses and better movement in forest. Elves also have the <i>neutral</i> alignment, meaning that they are unaffected by and fight equally well during all times of day. The number of elven units you have access to is limited, so be sure to protect them and use them wisely."
        [/hint_message]
    [/event]

    [event]
        name=turn 6
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Multiple Healers"
            message= _ "You now have two healers. However, each unit can only receive healing from one healing source: even when standing next to Ethiliel and a druid, a unit will only be healed by 8 hitpoints per turn.

In general, a unit next to multiple healers or standing on a village is healed by the most advanced source of healing."
        [/hint_message]
    [/event]

    [event]
        name=turn 8
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Income Strategy"
            message= _ "Seeking out and capturing villages is not only important to supporting your own forces, but also to denying enemy income. If the enemy seems to constantly be recruiting and you are unable to make progress, consider trying to capture some of their villages to deny their source of gold."
        [/hint_message]
    [/event]

    [event]
        name=turn 10
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            remove=yes
        [/hint_message]
    [/event]

    [event]
        name=turn 12
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "The Danger of Poison"
            message= _ "Any units that are <i>poisoned</i> continuously lose hitpoints, even when not in direct combat with enemies. Take care not to let enemies spread poison among multiple units and make sure to keep your healers safe: Ethiliel can minimize the damage you take from poison as long as you position her properly."
        [/hint_message]
    [/event]

    [event]
        name=turn 14
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            remove=yes
        [/hint_message]
    [/event]

    [event]
        name=turn 15
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Fighting in Enemy Bases"
            message= _ "Assaulting an enemy castle can be difficult due to its improved defenses, as well as the fresh reinforcements that may be recruited close to the battle. Some strategies for effectively fighting an enemy in their own base are denying their villages to cut off their income, luring their units off castle hexes, and occupying the castle hexes with your own units. If their leader moves off their keep to fight or heal, you can also seize the opportunity to capture the keep for yourself!"
        [/hint_message]
    [/event]

    [event]
        name=turn 17
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Retreating and Reengaging"
            message= _ "Just because you have begun to fight the enemy does not mean you must continuously do so. Should the time of day become unfavorable or should they gain reinforcements, it may be wise to retreat temporarily to regather your forces and fight them on terrain that is more advantageous to you. You can also retreat to heal wounded units and reengage once they have recovered."
        [/hint_message]
    [/event]

    [event]
        name=turn 19
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Multiple Enemy Sides"
            message= _ "A scenario may have multiple enemy sides, who may or may not be aligned with one another. If you notice enemies begin to fight one another, you can use this to your advantage by letting them weaken each others’ forces before moving in to finish both off."
        [/hint_message]
    [/event]

    [event]
        name=turn 20
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            remove=yes
        [/hint_message]
    [/event]

    [event]
        name=turn 22
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Strategy Around Chokepoints"
            message= _ "Chokepoints are areas where there are one or two hex-wide paths of favorable terrain, such as a bridge over water, or a narrow path between castle hexes. At a chokepoint, you can easily hold an enemy back by occupying the terrains with high defenses and forcing them onto the hexes where they will have lower defenses."
        [/hint_message]
    [/event]

    [event]
        name=turn 24
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Strategy Around Chokepoints"
            message= _ "Enemies can also prevent you from advancing at chokepoints by limiting the number of units that can engage in a single turn. Use the chokepoint to your advantage if you are getting overwhelmed from multiple directions, or avoid it if you are getting bogged down and getting close to the turn limit."
        [/hint_message]
    [/event]

    [event]
        name=turn 27
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            remove=yes
        [/hint_message]
    [/event]

    [event]
        name=sighted
        [filter]
            id="Mal M'Brin"
        [/filter]
        {TUTORIAL_ENABLE_CONDITION}

        {TALK_ABOUT (Mal M'Brin) ( _ "That corrupted sage is a powerful level 3 unit, with particularly dangerous ranged <i>magical</i> attacks. We should engage him carefully and avoid placing low health units close to him. We better wait until daytime to attack him, when he is much weaker.")}
    [/event]

    [event]
        name=attack_end
        [filter]
            side=1
        [/filter]
        [filter_second]
            type_adv_tree=Skeleton,Skeleton Archer
        [/filter_second]
        {TUTORIAL_ENABLE_CONDITION}

        [message]
            speaker=Deoran
            message= _ "Our weapons are ineffective against these skeletons! What should we do?"
        [/message]

        [message]
            speaker=Mari
            message= _ "These skeletons are resistant to <i>pierce</i> attacks, but less resilient against <i>blade</i> attacks, and particularly vulnerable to <i>impact</i> attacks. We should prioritize using units with <i>blade</i> or <i>impact</i> attacks."
        [/message]
    [/event]
#enddef

#define TSG_TUTORIAL_EVENTS_S5
    [event]
        name=side 1 turn 1
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Scenario Specific Mechanics"
            message= _ "Some scenarios have mechanics that are specific to that scenario alone. In this scenario, Ethiliel has the ability to reveal flat terrain through the otherwise dense forest in front of you as long as she is close to the existing path. This mechanic is also explained in the <i>notes</i> section of the <i>objectives</i>. Use this mechanic to hasten your path toward the <i>victory condition</i>, which is to reach the northern bank of the river."
        [/hint_message]
    [/event]

    [event]
        name=turn 4

        [hint_message]
            remove=yes
        [/hint_message]
    [/event]

    [event]
        name=turn 6
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Ambush"
            message= _ "Some units have abilities that hide them from view under certain conditions. Enemy elves on this map have <i>ambush</i>, which hides them in forest until one of your units moves adjacent to them. The unit that discovers the ambusher will reveal the ambusher but lose all of its remaining movement."
        [/hint_message]
    [/event]

    [event]
        name=turn 8
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Strategy Against Hidden Units"
            message= _ "Against <i>ambushers</i> or other units with abilities that hide them, it is important to keep your units close together and protect your most vulnerable units in the middle of the group. Use <i>zone of control</i> and travel in groups to prevent ambushers from targeting low health units."
        [/hint_message]
    [/event]

    [event]
        name=turn 9
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Strategy Against Hidden Units Part II"
            message= _ "In this scenario, all <i>ambushers</i> will not become active until you reveal them. However, in other campaigns, enemy units may actively seek to assault you even while hidden. It is important to keep track of what conditions the enemy unit may be hidden, as well as how many units have that ability. This will allow you to prepare for them properly."
        [/hint_message]
    [/event]

    [event]
        name=turn 11
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Protecting Healers"
            message= _ "The health of your healers is especially important; so long as they can remain close to the front of the battle, they can continuously help your other units recuperate damage. If you have multiple healers, placing them next to one another can help protect them. Using <i>zone of control</i> to prevent enemy units from reaching your healers is also important to keeping them safe."
        [/hint_message]
    [/event]

    [event]
        name=turn 13
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Victory Conditions"
            message= _ "In scenarios where victory conditions are not to defeat the enemy, it is important to keep an eye on progress toward the objective. Strike a balance between gaining experience from enemy units while progressing toward the victory condition by the turn limit. Avoid pursuing enemy units when assaulting them would put you in a bad position or if you are behind on progress in the scenario."
        [/hint_message]
    [/event]

    [event]
        name=turn 14
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            remove=yes
        [/hint_message]
    [/event]
#enddef

#define TSG_TUTORIAL_EVENTS_S6
    [event]
        name=turn 2
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Victory Conditions"
            message= _ "In this scenario, the victory condition is simply to survive until the end of turns (without otherwise being defeated). In these types of scenarios, it may be more prudent to play defensively and hold terrain where you have an advantageous position. Do not be afraid to retreat if the situation demands it."
        [/hint_message]
    [/event]
    [event]
        name=turn 4
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            remove=yes
        [/hint_message]

        [message]
            speaker=Mari
            message= _"Deoran, we need units that are good on defense and at holding positions. We should consider using more regular infantry, who have higher defenses on castle tiles compared to cavalry. Scouting is not important for this mission. We can also now recruit <i>Heavy Infantrymen</i>, who have lower movement but improved resistances compared to <i>Spearmen</i> or <i>Bowmen</i>. <i>Heavy Infantrymen</i> are especially good at holding castle terrain."
        [/message]
    [/event]
#enddef
