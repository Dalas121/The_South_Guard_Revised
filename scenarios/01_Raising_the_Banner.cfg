#textdomain wesnoth-tsg
[scenario]
    id=01_Raising_the_Banner
    map_file=01a_Raising_the_Banner.map
    name= _ "Raising the Banner"
    next_scenario=01x_Westin
    victory_when_enemies_defeated=no
    
    {DEFAULT_SCHEDULE_DAWN} # so there's no ToD effects on the first turn
    turns=-1
    
    {SCENARIO_MUSIC loyalists.ogg}
    {EXTRA_SCENARIO_MUSIC battle.ogg}
    {EXTRA_SCENARIO_MUSIC knolls.ogg}

    {~add-ons/The_South_Guard_Revised/utils/sg_deaths.cfg}    
    
    #######################################################################################################################################################
    #                                                                   DEFINE SIDES
    #######################################################################################################################################################
    #############################
    # DEORAN
    #############################
    [side]  # wmllint: validate-off
        side=1
        controller=human
        no_leader=yes
        team_name=South_Guard
        user_team_name=_"South Guard"
        gold=75
        recruit=Spearman,Bowman
        {CUSTOM_SG_FLAG}
        defeat_condition=never
    [/side] # wmllint: validate-on
    
    #############################
    # MARI
    #############################
    [side]
        side=2
        color=red
        controller=null
        no_leader=yes
        hidden=yes
        team_name=South_Guard,quintain
    [/side]
    [side]
        side=3
        color=blue
        controller=ai
        no_leader=yes
        hidden=yes
        team_name=quintain
    [/side]
    
    #############################
    # BANDITS
    #############################
    [side]
        side=4
        color=blue
        controller=ai
        no_leader=yes
        hidden=yes
        team_name=bandits
        user_team_name=_"Bandits"
        recruit=Thug
        {FLAG_VARIANT6 ragged}
    [/side]
    {SILENTLY_LIMIT_LEADER_MOVES 4 1}
    [event]
        name=side 4 turn
        first_time_only=no
        {RESET_SIDE_AI 4 offensive 0.4 0.25}
        {VARY_AI_BY_SCHEDULE 4}
        {MODIFY_SIDE_AI 4 ([avoid] # let's at least pretend the AI is smart. New players can wait until later to realize the AI is actually dumb
            terrain=Ww^* # TODO make this better
        [/avoid])}
    [/event]
    
    
    
    
    
    #######################################################################################################################################################
    #                                                                     PREPARE MAP
    #######################################################################################################################################################
    [event]
        name=prestart
        
        #############################
        # DEORAN AND MARI
        #############################
        [unit]
            side=2
            x,y=10,4
            facing=ne
            id=Mari
            name= _ "Mari"
            type=TSG Captain
            unrenamable=yes
            [modifications]
                {TRAIT_LOYAL_HERO}
                {TRAIT_QUICK}
            [/modifications]
        [/unit]
    [/event]
    #######################################################################################################################################################
    #                                                                    PLAY SCENARIO
    #######################################################################################################################################################
    [event]
        name=start
        
        {DELAY 500}
        [unit]
            id=Deoran
            name= _ "Deoran"
            profile=portraits/deoran.webp
            type=Junior Commander
            [modifications]
                [trait]
                    id,name=loyal_dummy,_"loyal"
                    description= _ "Zero upkeep"
                    [effect]
                        apply_to=loyal
                    [/effect]
                [/trait]
                {TRAIT_INTELLIGENT}
            [/modifications]
            canrecruit=yes
            unrenamable=yes
            side=1
            x,y=17,1
            facing=sw
            animate=yes
        [/unit]
        
        #############################
        # OPENING CUTSCENE
        #############################
        [message]
            speaker=Deoran
            image=portraits/deoran-glad.webp
            #po: deoran is fresh out of training, bright-eyed and eager to prove himself
            message= _ "Commander Deoran, reporting for duty SIR! ...err, ma’am."
        [/message]
        [message]
            speaker=Mari
            #po: "academy" refers to some sort of Wesnoth military academy
            message= _ "Relax, commander. Fresh from the academy, are we?"
        [/message]
        [message]
            speaker=Deoran
            #po: Deoran and Mari are here because Magistrate Fiore (from Westin) ordered them to come and make sure bandits don't interrupt Garard and Asheviere's upcoming wedding
            message= _ "Yes ma’am. —sir. And as the magistrate ordered, I’ve brought with me a contingent of fresh soldiers to ensure the king’s wedding goes exactly as planned."
        [/message]
        [message]
            speaker=Mari
            #po: Mari is somewhat sarcastic and not particularly emotive. She can come across as somewhat cold.
            message= _ "I’m Mari. Got the same orders as you; guess Magistrate Fiore wanted someone with experience to keep an eye on you and your “fresh” company. Can’t imagine why."
        [/message]
        [message]
            speaker=Mari
            #po: Mari only has 1 arm; she lost her left arm fighting undead in the Estmark hills.
            message= _ "Nothing I’d rather be doing. I am elated to march to the end of civilization and supervise this extremely meaningful ceremony, rather than relaxing at home or practicing one-armed swordsmanship. Fun."
        [/message]
        [message]
            speaker=Mari
            message= _ "*sigh* Well, I guess orders are orders. Come on over here, Deoran — let’s get a closer look at you."
        [/message]
        [message]
            speaker=Deoran
            [option]
                label= _ "On my way!"
                [command]
                    {VARIABLE enable_tutorial_elements yes}
                    [fire_event]
                        name=play_tutorial
                    [/fire_event]
                [/command]
            [/option]
            [option]
                label= _ "I know what I’m doing. (Skip tutorial)"
                [command]
                    {VARIABLE enable_tutorial_elements no}
                    [message]
                        speaker=Mari
                        message= _ "Suit yourself. I’m sure you won’t need my help against those bandits anyway."
                    [/message]
                    [fire_event]
                        name=play_battle
                    [/fire_event]
                [/command]
            [/option]
        [/message]
    [/event]
    
    
    
    
    
    
    #######################################################################################################################################################
    #                                                                    PLAY TUTORIAL
    #######################################################################################################################################################
#define TUTORIAL_ARROW X Y
    [item]
        name=arrow
        x,y={X},{Y}
        image=misc/highlight-hex.png
        halo=misc/arrow[10~19,20~11].png
    [/item]
#enddef
#define REMOVE_ARROW
    [remove_item]
        name=arrow
    [/remove_item]
#enddef
#define EXPLAIN_UNDO VALID_HEXES
    [event]
        name=moveto
        {FILTER( moves=Deoran {NOT({VALID_HEXES})} )}
        [filter_condition]
            {VARIABLE_CONDITIONAL undo_explained not_equals yes}
        [/filter_condition]
        [message]
            speaker,image=narrator,wesnoth-icon.png
            {TUTOR: _"Press “u” if you need to undo a move."}
        [/message]
        [allow_undo]
        [/allow_undo]
        {VARIABLE undo_explained yes}
    [/event]
#enddef
    [event]
        name=play_tutorial
        
        #############################
        # TUTORIAL 1: MOVE DEORAN
        #############################
        {TUTORIAL_ARROW 17 1}
        [event]
            name=select
            {FILTER id=Deoran}
            {REMOVE_ARROW}
            {TUTORIAL_ARROW 11 5}
        [/event]
        {EXPLAIN_UNDO x,y=11,5}
        [disallow_end_turn]
            reason=_"Move Deoran next to Mari first!
(press “u” if you need to undo a move)"
        [/disallow_end_turn]
        
        #------------------------
        # SHOW DESTINATION HEX
        #------------------------
        [objectives]
            [objective]
                description= _ "Move Deoran next to Mari"
                condition=win
            [/objective]
            [objective]
                description= _ "Get yourself killed"
                condition=lose
            [/objective]
        [/objectives]

        
        #############################
        # TUTORIAL 2: ATTACK QUINTAIN
        #############################
        [event]
            name=moveto
            {FILTER id,x,y=Deoran,11,5}
            
            #------------------------
            # INTRO
            #------------------------
            {REMOVE_ARROW}
            [message]
                speaker=Deoran
                message= _ "*bowing* A pleasure to make your acquaintance, Captain Mari."
            [/message]
            [message]
                speaker=Mari
                #po: I feel that "stab your spear" sounds better than "stab with your spear"; it matches the cadence of "ride your horse"
                message= _ "Amazing, you know how to ride your horse. Now let’s see if you know how to stab your spear."
            [/message]
            [store_unit]
                {FILTER id=Mari}
                variable=stored_mari
                kill=yes
            [/store_unit]
            {NAMED_UNIT 3 Quintain 10 4 quintain "" ()} {FACING se} {GUARDIAN}
            {FAKE_UNIT_MOVE 10 9 4 5 2 (TSG Captain) ()}
            [unstore_unit]
                variable=stored_mari
                x,y=9,5
            [/unstore_unit]
            [message]
                speaker=Deoran
                message= _ "...a quintain? You want me to attack a practice dummy?"
            [/message]
            [message]
                speaker=Mari
                message= _ "Too dangerous for you? Perhaps I can find a stuffed doll instead."
            [/message]
            
            #------------------------
            # OBJECTIVES
            #------------------------
            [disallow_end_turn]
                reason=_"Attack the dummy first!"
            [/disallow_end_turn]
            [objectives]
                [objective]
                    description= _ "Attack the dummy"
                    condition=win
                [/objective]
                [objective]
                    description= _ "Get yourself killed"
                    condition=lose
                [/objective]
            [/objectives]
            
            #------------------------
            # ATTACK INDICATORS
            #------------------------
            {TUTORIAL_ARROW 11 5}
            [event]
                name=select
                {REMOVE_ARROW}
                {TUTORIAL_ARROW 10 4}
            [/event]
            [event]
                name=attack
                {REMOVE_ARROW}
            [/event]
            
            #------------------------
            # HARDCODE HITS/MISSES
            #------------------------
            # make the tutorial more consistent, so that dialogue is guaranteed to be sensible regardless of RNG
#define FORCE_ACCURACY UNIT VALUE
            [remove_object]
                object_id=force_cth_{UNIT}
            [/remove_object]
            [modify_unit]
                {FILTER id={UNIT}}
                [object]
                    id=force_cth_{UNIT}
                    [effect]
                        apply_to=attack
                        [set_specials]
                            mode=append
                            [chance_to_hit]
                                value={VALUE}
                            [/chance_to_hit]
                        [/set_specials]
                    [/effect]
                [/object]
            [/modify_unit]
#enddef
            [event]
                name=attack
                {FILTER id=Deoran}
                    
                # hardcode Deoran's first 3 strikes - show the player what a hit looks like twice, then show them what a miss looks like
                {FORCE_ACCURACY Deoran 100}
                [event]
                    name=attacker hits
                    {FILTER id=Deoran}
                    [event]
                        name=attacker hits
                        {FILTER id=Deoran}
                        {FORCE_ACCURACY Deoran 0}
                        [event]
                            name=attacker misses
                            {FILTER id=Deoran}
                            [remove_object]
                                object_id=force_cth_Deoran
                            [/remove_object]
                        [/event]
                    [/event]
                [/event]
                
                # hardcode the quintian's first 4 strikes (2 defending, 2 attacking) - get Deoran low, but don't kill him
                {FORCE_ACCURACY quintain 100}
                [event]
                    name=defender hits
                    {FILTER_SECOND id=quintain}
                    {FORCE_ACCURACY quintain 0}
                    [event]
                        name=defender misses
                        {FILTER_SECOND id=quintain} # the quintain gets deleted and replaced after this
                        [event]
                            name=attack
                            {FORCE_ACCURACY quintain 100}
                            [event]
                                name=new turn
                                [remove_object]
                                    object_id=force_cth_quintain
                                [/remove_object]
                            [/event]
                        [/event]
                    [/event]
                [/event]
            [/event]
        [/event]
        
        
        #############################
        # TUTORIAL 3: TURNS
        #############################
        [event]
            name=attack end
            
            # or else the quintain keeps playing it's defense anim
            {STORE_UNIT_VAR id=quintain hitpoints hitpoints}
            {KILL id=quintain}
            {NAMED_UNIT 3 Quintain 10 4 quintain "" ( experience,hitpoints=1,$hitpoints )} {FACING se}  {GUARDIAN}
            {CLEAR_VARIABLE hitpoints}
            
            #------------------------
            # INTRO
            #------------------------
            [message]
                speaker=Deoran
                image=portraits/deoran-mad.webp
                message= _ "Ow! This dummy fights back!"
            [/message]
            [message]
                speaker=Mari
                message= _ "I definitely should have started with the doll."
            [/message]
            [message]
                speaker=Deoran
                message= _ "I’m not about to lose to a dummy. Let me attack again!"
            [/message]
            [message]
                speaker=Mari
                message= _ "Nice try, but you used up your turn attacking the quintain. The quintain now gets to attack."
            [/message]
            [message]
                speaker=Deoran
                message= _ "The <i>dummy</i> gets a turn?"
            [/message]
            [message]
                speaker=Mari
                message= _ "You expected this to be easy? It’s a magical quintain, on loan from the wizards’ academy at Alduin. It strikes twice per attack, and does 10 “impact” damage per strike. Brace yourself!"
            [/message]
            [message]
                speaker,image=narrator,wesnoth-icon.png
                {TUTOR: _"To end your turn, click the <b>“End Turn”</b> button in the bottom-right corner of the screen, or press <b>Ctrl+Space</b>"}
            [/message]
            [allow_end_turn][/allow_end_turn]
            
            #------------------------
            # OBJECTIVES
            #------------------------
            [objectives]
                [objective]
                    description= _ "End your turn"
                    condition=win
                [/objective]
                [objective]
                    description= _ "Get yourself killed"
                    condition=lose
                [/objective]
            [/objectives]
        [/event]
        
        
        #############################
        # TUTORIAL 4: VILLAGES
        #############################
        [event]
            name=turn 2
            [message]
                speaker=Deoran
                image=portraits/deoran-sad.webp
                message= _ "I’m injured; this is more serious than expected. I need to retreat to a village and regain some hitpoints."
            [/message]
            {TUTORIAL_ARROW  8 6}
            {TUTORIAL_ARROW 12 7}
            [disallow_end_turn]
                reason=_"Move to a village first!
(press “u” if you need to undo a move)"
            [/disallow_end_turn]
            {EXPLAIN_UNDO(
                {OR x,y=8,6}
                {OR x,y=12,7}
            )}
            
            #------------------------
            # PREVENT ATTACKING
            #------------------------
            [event]
                name=pre attack
                id=prevent_attacking
                first_time_only=no
                [cancel_action]
                [/cancel_action]
                {STORE_UNIT_VAR id=Deoran hitpoints hitpoints}
                [message]
                    speaker=Deoran
                    message= _"I only have $hitpoints hitpoints left! If I attack now, I am sure to be vanquished. By a dummy, nonetheless."
                [/message]
                {CLEAR_VARIABLE hitpoints}
                [allow_undo]
                [/allow_undo]
            [/event]
            [event]
                name=side 1 turn end
                [remove_event]
                    id=prevent_attacking
                [/remove_event]
            [/event]
            
            #------------------------
            # OBJECTIVES
            #------------------------
            [objectives]
                [objective]
                    description= _ "End your turn on a village"
                    condition=win
                [/objective]
                [objective]
                    description= _ "Get yourself killed"
                    condition=lose
                [/objective]
            [/objectives]
            
            #------------------------
            # VILLAGE EXPLANATION
            #------------------------
            [event]
                name=capture
                {REMOVE_ARROW}
                [message]
                    speaker=Mari
                    message= _"You have captured a village, which now flies the fabulously pretty colors of our banner. Villages provide the shiny gold <i>income</i> we need to <i>recruit</i> units. The house icon at the top of the screen shows our total village count."
                [/message]
                [message]
                    speaker=Mari
                    message= _"More to the point, villages also provide healing. Starting your turn on a village will <i>heal</i> you for 8 hitpoints. End your turn now."
                [/message]
                [allow_end_turn][/allow_end_turn]
            [/event]
        [/event]
        
        
        #############################
        # TUTORIAL 5: RECRUITING
        #############################
        [event]
            name=side 1 turn 3 refresh
            [message]
                speaker=Mari
                message= _"Congratulations, you ran away from the quintain and have regained 8 hitpoints from your village. I hope you’re proud."
            [/message]
            [message]
                speaker=Deoran
                message= _"I’ve had enough of being humiliated by this dummy. Time to recruit some proper soldiers and smash that thing to pieces."
            [/message]
            [message]
                speaker,image=narrator,wesnoth-icon.png
                {TUTOR: _"The golden crown in Deoran’s upper-left-hand corner indicates he’s a leader: he can <b>recruit</b> new units when standing on a castle’s <b>keep</b> hex.

In most scenarios, you will lose if your leader is killed. Don’t use Deoran too aggressively!"}
            [/message]
            {TUTORIAL_ARROW 9 10}
            [disallow_end_turn]
                reason=_"Recruit a soldier first!
(press “u” if you need to undo a move)"
            [/disallow_end_turn]
            {EXPLAIN_UNDO x,y=9,10}
            
            #------------------------
            # OBJECTIVES
            #------------------------
            [objectives]
                [objective]
                    description= _ "Recruit some soldiers"
                    condition=win
                [/objective]
                [objective]
                    description= _ "Get yourself killed"
                    condition=lose
                [/objective]
            [/objectives]
            
            #------------------------
            # EXPLAIN RECRUITING
            #------------------------
            [event]
                name=moveto
                {FILTER id,x,y=Deoran,9,10}
                {REMOVE_ARROW}
                [message]
                    speaker=Deoran
                    message= _"Good, I’m on the keep. If I press <b>Ctrl-R</b>, I can recruit new soldiers to help me fight."
                [/message]
            [/event]
            
            [event]
                name=recruit
                priority=99
                [message]
                    speaker=unit
                    message= _"At your service, commander Deoran!"
                [/message]
            [/event]
            # in between these, we explain how spearman/bowmen work
            [event]
                name=recruit
                priority=-99
                [message]
                    speaker=Deoran
                    message= _"I’ll need to end my turn before my new recruits can move and attack."
                [/message]
                [allow_end_turn][/allow_end_turn]
            [/event]
        [/event]
        
        
        #############################
        # TUTORIAL 6: KILLING THE QUINTAIN
        #############################
        [event]
            name=turn 4
            [message]
                speaker=Deoran
                message= _"The quintain is healing itself! Come on men, let’s go finish it off!"
            [/message]
            [message]
                speaker,image=narrator,wesnoth-icon.png
                {TUTOR: _"In addition to the +8 healing provided by a village, units will also regenerate 2 hitpoints if they spend their turn resting: neither moving nor fighting.

This “rest-healing” stacks with village healing."}
            [/message]
            
            #------------------------
            # OBJECTIVES
            #------------------------
            [objectives]
                [objective]
                    description= _ "Kill Mari’s quintain"
                    condition=win
                [/objective]
                [objective]
                    description= _ "Get yourself killed"
                    condition=lose
                [/objective]
            [/objectives]
            
            #------------------------
            # QUINTAIN DIES
            #------------------------
            [event]
                name=die
                {FILTER id=quintain}
                [message]
                    speaker=second_unit
                    message= _ "Hooray! The quintain is destroyed, and I have gained 8 experience!"
                [/message]
                [message]
                    speaker,image=narrator,wesnoth-icon.png
                    {TUTOR: _"Units gain a small amount of experience when attacking or defending, but gain much more by striking a finishing blow, especially vs high-level enemies.

With enough experience, a soldier will advance to a powerful level-2 unit."}
                [/message]
                [message]
                    speaker=Mari
                    message= _ "Bravo, you’ve smashed it to pieces. I was supposed to return that dummy once we’d finished guarding the royal wedding."
                [/message]
                {DELAY 500}
                [message]
                    speaker=Mari
                    message= _ "Of course, we’ll have to fight our way past these bandits first."
                [/message]
                [fire_event]
                    name=play_battle
                [/fire_event]
            [/event]
        [/event]
        
        
        #############################
        # MARI GETS BORED EVENTUALLY
        #############################
        [event]
            name=turn 8
            {FILTER_CONDITION( {HAVE_UNIT id=quintain} )}
            [message]
                speaker=Mari
                message= _ "You’re doing a great job, just standing there. Either finish off the quintain or give up and go home."
            [/message]
        [/event]
        [event]
            name=turn 13
            {FILTER_CONDITION( {HAVE_UNIT id=quintain} )}
            [message]
                speaker=Mari
                message= _ "Very funny. You should consider becoming a comedian, because after this performance you’re definitely not going to be a knight. Go home, Deoran. I’ll handle things on my own here."
            [/message]
            [endlevel]
                result=defeat
            [/endlevel]
        [/event]
    [/event]
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    #######################################################################################################################################################
    #                                                                        PLAY BATTLE
    #######################################################################################################################################################
    [event]
        name=play_battle
        [message]
            speaker=Deoran
            message= _ "Bandits! Where?"
        [/message]
        
        #############################
        # PREPARE MAP
        #############################
        [replace_map]
            map_file=01_Raising_the_Banner.map
            expand,shrink=yes,yes
        [/replace_map]
        {NAMED_UNIT 4 Bandit 16 20 "Urza Mathin" _"Uzra Mathin" ( canrecruit=yes {MODIFICATIONS({TRAIT_QUICK}{TRAIT_INTELLIGENT})} )} # quick because easier to kill 
        [modify_side]
            side=4
            hidden=no
            gold={ON_DIFFICULTY 0 0 30}
            income={ON_DIFFICULTY -2 0 2} # plus 2-3 villages
        [/modify_side]
        [capture_village]
            side=4
            x,y,radius=19,19,10
        [/capture_village]
        {GENERIC_UNITC 4 ({ON_DIFFICULTY Thug Thug Thug}) 11 20 ()}
        {GENERIC_UNITC 4 ({ON_DIFFICULTY Thug Thug Thug}) 13 22 ()}
        {GENERIC_UNITC 4 ({ON_DIFFICULTY none Thug Thug}) 12 15 ()}
        {GENERIC_UNITC 4 ({ON_DIFFICULTY none Thug Thug}) 11 15 ()}
        [modify_turns]
            value=25 # this includes the turns we spent fighting the dummy
        [/modify_turns]
        
        #############################
        # INTRO CUTSCENE
        #############################
        {SCROLL_TO 16 20}
        {DELAY 500}
        [message]
            speaker=Urza Mathin
            message= _ "Oh, what’s this? A lady and her loyal squire travelin’ south on this dangerous road? Tell ya what, we can offer ya protection ’round here for a small fee."
        [/message]
        [if] {HAVE_UNIT id,x,y=Deoran,17,1}
            [then]
                {TELEPORT_UNIT id=Deoran 9 10}
                [capture_village]
                    side=1
                    x,y,radius=10,6,3
                [/capture_village]
            [/then]
        [/if]
        [message]
            speaker=Deoran
            image=portraits/deoran-mad.webp
            message= _ "Do you take us for fools? I represent the newly-formed South Guard, on orders from Magistrate Fiore to ensure the countryside is kept safe and orderly for King Garard’s upcoming wedding."
        [/message]
        [message]
            speaker=Deoran
            image=portraits/deoran-mad.webp
            message= _ "The only danger around here is you, and I intend to put an end to your reign of terror, scum! Men, raise your spears!"
        [/message]
        [message]
            speaker=Urza Mathin
            message= _ "Hah, like it would be that easy, boy. Time to show you that the Urza brothers are the real power in these parts!"
        [/message]
        
        #############################
        # OBJECTIVES
        #############################
        [objectives]
            side=1
            [objective]
                description= _ "Defeat Urza Mathin"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Deoran"
                condition=lose
            [/objective]
            # it's impossible for Mari to die, since the bandits avoid her
            {TURNS_RUN_OUT}
            [gold_carryover]
                bonus=yes
                carryover_percentage=40
            [/gold_carryover]
        [/objectives]
    [/event]
    
    #############################
    # MARI SPECTATES
    #############################
    [event]
        name=side 1 turn end
        [if] {VARIABLE_CONDITIONAL enable_tutorial_elements equals yes}
            [then]
                [message]
                    speaker=Mari
                    #po: sarcasm
                    message= _ "After seeing how well you dealt with that wooden dummy, I’m sure these few bandits won’t pose any problem."
                [/message]
            [/then]
        [/if]
        {MOVE_UNIT id=Mari 14 9}
        {MODIFY_UNIT id=Mari facing sw}
        [message]
            speaker=Mari
            message= _ "I’ll keep an eye on things from here, but don’t expect me to fight. This might make genuinely good practice for you as your first real battle."
        [/message]
        [if] {VARIABLE_CONDITIONAL enable_tutorial_elements equals yes}
            [then]
                [message]
                    speaker,image=narrator,wesnoth-icon.png
                    {TUTOR: _"You may toggle tips on or off at any time during the campaign by right-clicking anywhere and selecting “Tips: On/Off” in the menu."}
                [/message]
            [/then]
            [else]
                [message]
                    speaker,image=narrator,wesnoth-icon.png
                    {TUTOR: _"You may toggle tips on or off at any time during the campaign by right-clicking anywhere and selecting “Tips: On/Off” in the menu.

Because you skipped the tutorial, tips are currently off."}
                [/message]
            [/else]
        [/if]
        
        #############################
        # TUTORIAL TOGGLE
        #############################
        [set_menu_item]
            id=tutorial_toggle_on
            description= _ "Tips: On"
            image="wesnoth-icon.png~SCALE(18,18)"
            [show_if]
                [variable]
                    name=enable_tutorial_elements
                    boolean_equals=yes
                [/variable]
            [/show_if]
            [command]
                {VARIABLE enable_tutorial_elements no}
                [hint_message]
                    remove=yes
                [/hint_message]
            [/command]
        [/set_menu_item]
        [set_menu_item]
            id=tutorial_toggle_off
            description= _ "Tips: Off"
            image="wesnoth-icon.png~SCALE(18,18)"
            [show_if]
                [variable]
                    name=enable_tutorial_elements
                    boolean_equals=no
                [/variable]
            [/show_if]
            [command]
                {VARIABLE enable_tutorial_elements yes}
            [/command]
        [/set_menu_item]
    [/event]

    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
#     # The Fort
#     [event]
#         name=moveto
# 
#         [filter]
#             side=1
#             x,y=9,10
#         [/filter]
# 
#         [remove_item]
#             x,y=9,10
#         [/remove_item]
# 
#         [message]
#             speaker=Deoran
#             message= _ "Who goes there? Show yourself!"
#         [/message]
# 
#         [unit]
#             side=1
#             type=Spearman
#             id=Aleron
#             name= _ "Aleron"
#             x,y=10,9
#             [modifications]
#                 {TRAIT_RESILIENT}
#                 {TRAIT_STRONG}
#             [/modifications]
#         [/unit]
# 
#         [message]
#             speaker=Aleron
#             message= _ "You and your kind will never take this fort! Never, I say!"
#         [/message]
# 
#         [message]
#             speaker=Deoran
#             image=portraits/deoran-mad.webp
#             message= _ "My kind? We are messengers appointed by the King himself! What do you mean, <i>“my kind”</i>? And where is the South Guard?"
#         [/message]
# 
#         [message]
#             speaker=Aleron
#             message= _ "My deepest apologies! I and several other villagers came to this old fort seeking refuge from the bandits! I know not the circumstances, but the South Guard has not come here in a long while; they hold only the farmlands immediately surrounding Westin."
#         [/message]
# 
#         [message]
#             speaker=Mari
#             message= _ "Is that so? Then seeing as they are absent, we essentially represent the South Guard now. Raise the banners and prepare for battle!"
#         [/message]
# 
#         [modify_side]
#             side=1
#             {CUSTOM_SG_FLAG}
#         [/modify_side]
# 
#         [allow_recruit]
#             side=1
#             type=Spearman, Bowman
#         [/allow_recruit]
# 
#         {VARIABLE moved_to_fort yes}
#         [show_objectives][/show_objectives]
#     [/event]
# 
#     [event]
#         name=turn 2
# 
#         [message]
#             speaker=Urza Mathin
#             message= _ "Oh, what’s this? A lady and her loyal squire traveling all alone on this dangerous road? Tell ya what, we can offer ya protection ’round here for a small fee."
#         [/message]
# 
#         [message]
#             speaker=Deoran
#             image=portraits/deoran-mad.webp
#             message= _ "What do you take us for, fools? The only danger around here is you, and I intend to put an end to your reign of terror, scum!"
#         [/message]
# 
#         [message]
#             speaker=Urza Mathin
#             message= _ "Hah, like it would be that easy, boy. Time to show you how the Urza brothers do things in these parts!"
#         [/message]
# 
#         [gold]
#             side=2
#             amount={ON_DIFFICULTY 30 35 40}
#         [/gold]
#     [/event]
# 
#     [event]
#         name=turn 5
#         [if]
#             [not]
#                 [have_unit]
#                     id=Aleron
#                 [/have_unit]
#             [/not]
#             [then]
#                 {HIGHLIGHT_IMAGE 9 10 items/gohere.png ()}
# 
#                 [message]
#                     speaker=Mari
#                     message= _ "We should investigate the fort to see if there are any supplies."
#                 [/message]
#             [/then]
#         [/if]
#     [/event]
# 
#     [event]
#         name=attack
#         [filter]
#             id=Mari
#         [/filter]
# 
#         [message]
#             speaker=Mari
#             message= _ "I guess I have a job to do..."
#         [/message]
#     [/event]
# 
#     # Dawn
#     [event]
#         name=turn 6
# 
#         [message]
#             speaker=Mari
#             message= _ "The sun is rising. ’Tis your moment of glory, Officer Deoran."
#         [/message]
# 
#         [message]
#             speaker=Deoran
#             message= _ "I’m ready to charge!"
#         [/message]
# 
#         [message]
#             speaker=Urza Mathin
#             message= _ "Curses, they survived the night! Looks like I’ll have to use the trick my brother taught me to take care of this."
#         [/message]
# 
#         [sound]
#             name=zombie-attack.wav
#         [/sound]
#         [delay]
#             time=300
#         [/delay]
#         [sound]
#             name=zombie-hit-2.ogg
#         [/sound]
#         [delay]
#             time=300
#         [/delay]
# 
#         [unit]
#             side=2
#             type=Walking Corpse
#             x,y=15,19
#             animate=yes
#         [/unit]
#         [sound]
#             name=zombie-hit-4.ogg
#         [/sound]
#         [unit]
#             side=2
#             type=Walking Corpse
#             x,y=15,19
#             animate=yes
#         [/unit]
# 
#         [message]
#             speaker=Urza Mathin
#             message= _ "Haha! Tremble before the might of the brothers Urza!"
#         [/message]
# 
#         [message]
#             speaker=Deoran
#             message= _ "What?! A mere bandit with the dark power of necromancy at his command? How can this be?"
#         [/message]
# 
#         [message]
#             speaker=Mari
#             message= _ "One picks up all kinds of skills to survive in the wilderness, but this is indeed a bit peculiar..."
#         [/message]
# 
#         [allow_recruit]
#             side=2
#             type=Walking Corpse
#         [/allow_recruit]
# 
#         # split the gold to make it easier for the player
#         [gold]
#             side=2
#             amount={ON_DIFFICULTY 10 20 30}
#         [/gold]
#     [/event]
# 
#     [event]
#         name=time over
# 
#         {GENERIC_UNIT 2 (Thug) 14 18}
#         {GENERIC_UNIT 2 (Footpad) 15 20}
#         {GENERIC_UNIT 2 (Skeleton) 14 19}
#         {GENERIC_UNIT 2 (Skeleton Archer) 16 18}
#         {GENERIC_UNIT 2 (Poacher) 16 19}
# 
#         [message]
#             speaker=Urza Mathin
#             message= _ "Reinforcements from my brothers! Excellent. These lands belong to the brothers Urza!"
#         [/message]
#         [message]
#             speaker=Mari
#             message= _ "That’s a lot more forces than I expected! We’ll have to retreat and bring more soldiers. I didn’t want to get delayed like this on our first mission..."
#         [/message]
#     [/event]
# 
#     # Victory - The bandits are defeated.
# 
#     [event]
#         name=last breath
#         [filter]
#             id=Urza Mathin
#         [/filter]
# 
#         [message]
#             speaker=Mari
#             message= _ "Hold it right there, you balding scum. There is no way you learned how to raise those corpses yourself. Who taught you how to do that? Speak."
#         [/message]
# 
#         [message]
#             speaker=Urza Mathin
#             message= _ "I... it was... my brothers... avenge me..."
#         [/message]
# 
#         [kill]
#             x,y=$x1,$y1
#             animate=yes
#         [/kill]
# 
#         [message]
#             speaker=Mari
#             message= _ "That was a rather quick and pathetic death. Couldn’t even get any information out of him. At least you performed well on your first mission, Officer Deoran."
#         [/message]
# 
#         [message]
#             speaker=Deoran
#             message= _ "Fighting these petty bandits was easier than I was expecting! Some days, even training was harder than this, though undead had definitely not been part of any mock battles we had on the plains..."
#         [/message]
# 
#         [message]
#             speaker=Mari
#             message= _ "Yes, we will need to investigate that. Let’s head toward the city. Maybe someone in Westin will know something about this."
#         [/message]
# 
#         [set_achievement]
#             content_for=The_South_Guard_Revised
#             id=tsg_s01
#         [/set_achievement]
# 
#         [endlevel]
#             result=victory
#             bonus=yes
#             {NEW_GOLD_CARRYOVER 40}
#         [/endlevel]
# 
#         {CLEAR_VARIABLE moved_to_fort}
#     [/event]
    
    {SIDE_ONE_DESCRIPTIONS}
[/scenario]
