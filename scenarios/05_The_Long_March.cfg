#textdomain wesnoth-tsg
[scenario]
    id=05_The_Long_March

    name= _ "The Long March"
    next_scenario=06_Vengeance

    {SCENARIO_MUSIC casualties_of_war.ogg}
    {EXTRA_SCENARIO_MUSIC knolls.ogg}
    {EXTRA_SCENARIO_MUSIC weight_of_revenge.ogg}

    # Note: the map contains a large grid of roads but only one path through the
    # forest will be picked when the scenario starts. When editing the map, make
    # sure not to create any dead ends in the roads, and preferably also make
    # sure to not have sets of three dirt hexes all adjacent to each other.
    map_file=05_The_Long_March.map

    {DEFAULT_SCHEDULE_DUSK}

    victory_when_enemies_defeated=no
    {EXPERIENCE_MODIFIER}
    {TURNS 24 21 18}

    {SG_THE_LONG_MARCH}
    {TSG_BIGMAP {JOURNEY_05a_NEW} }

    # The South Guard

    [side]
        side=1
        type=TSG Captain
        id=Mari
        name= _ "Mari"
        unrenamable=yes
        canrecruit=yes

        team_name=South_Guard
        user_team_name=_"South Guard"
        controller=human
        {CUSTOM_SG_FLAG}

        fog=yes
        share_vision=all

        {GOLD 120 90 60}
        {INCOME 8 6 4}

        recruit=Bowman, Spearman, Merman Hunter, Cavalryman
    [/side]

    [side]
        side=2
        no_leader=yes
        team_name=elves
        hidden=yes
        controller=ai

        [ai]
            aggression=0.7
            caution=0.4
            [goal]
                name=target
                [criteria]
                    side=1
                [/criteria]
                value=5
            [/goal]
        [/ai]
        color=green
        {FLAG_VARIANT long}
    [/side]

    [side]
        side=3
        no_leader=yes
        team_name=elves
        share_vision=none
        controller=null
        controller_lock=yes
        hidden=yes
        color=green # must be same like side 2's
        {FLAG_VARIANT long}
    [/side]

    [side]
        side=4
        no_leader=yes
        team_name=monsters,elves
        user_team_name=_"Monsters"
        share_vision=none
        controller=ai
        controller_lock=yes
        hidden=yes
        color=orange
        {FLAG_VARIANT long}
    [/side]

    # This prestart event iterates through the labyrinth and picks a random
    # route through it, stores the path in $secret_path, covers everything with
    # forest and then places the ford on the endpoint of the chosen path.
    [event]
        name=prestart

        {VARIABLE previous_path_hex.x 18}
        {VARIABLE previous_path_hex.y 38}
        {VARIABLE new_path_hex.x 18}
        {VARIABLE new_path_hex.y 37}
        {VARIABLE secret_path.x 18}
        {VARIABLE secret_path.y 37}

        [while]
            [variable]
                name=new_path_hex.y
                greater_than=10
            [/variable]

            [do]
                [if]
                    [have_location]
                        terrain=R*^*

                        [filter_adjacent_location]
                            x,y=$new_path_hex.x,$new_path_hex.y
                            adjacent=sw,s,se
                        [/filter_adjacent_location]

                        [not]
                            x,y=$previous_path_hex.x,$previous_path_hex.y
                        [/not]
                    [/have_location]

                    [then]
                        [store_locations]
                            terrain=R*^*

                            [filter_adjacent_location]
                                x,y=$new_path_hex.x,$new_path_hex.y
                                adjacent=sw,s,se
                            [/filter_adjacent_location]

                            [not]
                                x,y=$previous_path_hex.x,$previous_path_hex.y
                            [/not]

                            variable=new_road_branches
                        [/store_locations]
                    [/then]

                    [else]
                        [store_locations]
                            terrain=R*^*

                            [filter_adjacent_location]
                                x,y=$new_path_hex.x,$new_path_hex.y
                                adjacent=nw,n,ne
                            [/filter_adjacent_location]

                            [not]
                                x,y=$previous_path_hex.x,$previous_path_hex.y
                            [/not]

                            variable=new_road_branches
                        [/store_locations]
                    [/else]
                [/if]

                {VARIABLE previous_path_hex.x $new_path_hex.x}
                {VARIABLE previous_path_hex.y $new_path_hex.y}

                [if]
                    [variable]
                        name=new_road_branches.length
                        numerical_equals=1
                    [/variable]

                    [then]
                        {VARIABLE new_path_hex.x $new_road_branches.x}
                        {VARIABLE new_path_hex.y $new_road_branches.y}
                    [/then]

                    [elseif]
                        [variable]
                            name=new_road_branches.length
                            greater_than=1
                        [/variable]

                        [then]
                            {RANDOM 1..$new_road_branches.length}
                            {VARIABLE_OP random sub 1}

                            {VARIABLE new_path_hex.x $new_road_branches[$random].x}
                            {VARIABLE new_path_hex.y $new_road_branches[$random].y}
                        [/then]
                    [/elseif]
                [/if]

                #[item]
                #    x,y=$new_path_hex.x,$new_path_hex.y
                #    image=misc/capture.png
                #[/item]

                [store_locations]
                    x,y=$new_path_hex.x,$new_path_hex.y

                    [or]
                        find_in=secret_path
                    [/or]

                    variable=secret_path
                [/store_locations]
            [/do]
        [/while]

        [store_locations]
            find_in=secret_path

            variable=secret_path_unrevealed
        [/store_locations]

        [store_locations]
            terrain=R*^*
            y=10-37

            variable=secret_path_to_hide
        [/store_locations]

        [foreach]
            array=secret_path_to_hide
            [do]
                [store_locations]
                    terrain=*^F*

                    [and]
                        x,y=$this_item.x,$this_item.y
                        radius=1
                    [/and]

                    variable=adjacent_forests
                [/store_locations]

                {RANDOM "1..$adjacent_forests.length"}
                {VARIABLE_OP random sub 1}

                [terrain]
                    x,y=$this_item.x,$this_item.y
                    terrain=$adjacent_forests[$random].terrain
                [/terrain]
            [/do]
        [/foreach]

        {VARIABLE ford_mask_x $new_path_hex.x}
        {VARIABLE_OP ford_mask_x sub 1}

        # This mask creates the ford at the end of the road
        [terrain_mask]
            x=$ford_mask_x
            y=3
            border=no
            mask="Ww^Ewl, Wwf, Ww^Ewl
Ww, Wwf, Ww^Ewl
Ww^Ewl, Wwf, Ww^Ewl
Ww, Wwf, Ww
Ww, Wwf, Ww^Ewl
Ww, Wwf, Ww^Ewl
Ww^Ewl, Wwf, Ww
Ww^Ewl, Wwf, Ww^Ewl
"

            [rule]
                old=!,W*
                use_old=yes
            [/rule]
        [/terrain_mask]

        {CLEAR_VARIABLE new_road_branches,secret_path_to_hide,adjacent_forests}
    [/event]

    [event]
        name=prestart
        [recall]
            id=Deoran
        [/recall]

#ifdef EASY
        {VARIABLE num_of_ambushers 10}
#endif

#ifdef NORMAL
        {VARIABLE num_of_ambushers 13}
#endif

#ifdef HARD
        {VARIABLE num_of_ambushers 16}
#endif

        # This places a bunch of lvl1 elves along the secret path, the player
        # will probably bump into all of these.
        {SCATTER_UNITS $num_of_ambushers "Elvish Fighter,Elvish Archer,Elvish Scout,Elvish Fighter" 2 (
            terrain=*^F*
            x=3-34
            y=13-31

            [filter_adjacent_location]
                find_in=secret_path
            [/filter_adjacent_location]

            [not]
                find_in=secret_path
            [/not]

            [not]
                [filter]
                [/filter]
            [/not]

            [not]
                [filter_adjacent_location]
                    [filter]
                    [/filter]
                [/filter_adjacent_location]
            [/not]
        ) (
            side=3
            generate_name=yes
            random_traits=yes
            upkeep=loyal
            role=ambusher # used only for flavor events

            [modifications]
                [object]
                    id=one_time_ambush
                    take_only_once=no
                    [effect]
                        apply_to=new_ability

                        [abilities]
                            [hides]
                                id=elvish_ambush
                                affect_self=yes

                                [filter_self]
                                    [filter_location]
                                        terrain=*^F*
                                    [/filter_location]
                                [/filter_self]
                            [/hides]
                        [/abilities]
                    [/effect]
                [/object]
            [/modifications]
        )}

        # This places lvl2 elves in the forest, away from the secret path. The
        # player will mostly only bump into these when wandering away from the
        # path, although a few might occasionally be close enough to join an
        # ambush by the lvl1 elves next to the path.
        {SCATTER_UNITS 30 "Elvish Hero,Elvish Captain,Elvish Ranger" 2 (
            terrain=*^F*
            x=3-34
            y=13-31

            [not]
                radius=4
                find_in=secret_path
            [/not]

            [not]
                [filter]
                [/filter]
            [/not]

            [not]
                [filter_adjacent_location]
                    [filter]
                    [/filter]
                [/filter_adjacent_location]
            [/not]
        ) (
            side=3
            generate_name=yes
            random_traits=yes
            upkeep=loyal
            role=ambusher # used only for flavor events

            [modifications]
                [object]
                    id=one_time_ambush
                    take_only_once=no
                    [effect]
                        apply_to=new_ability

                        [abilities]
                            [hides]
                                id=elvish_ambush
                                affect_self=yes

                                [filter_self]
                                    [filter_location]
                                        terrain=*^F*
                                    [/filter_location]
                                [/filter_self]
                            [/hides]
                        [/abilities]
                    [/effect]
                [/object]
            [/modifications]
        )}

#ifdef EASY
        {VARIABLE num_of_monsters 12}
#endif

#ifdef NORMAL
        {VARIABLE num_of_monsters 16}
#endif

#ifdef HARD
        {VARIABLE num_of_monsters 20}
#endif

        # This places a bunch of monsters all over the map
        {SCATTER_UNITS $num_of_monsters "Woodland Boar,Piglet,Dragonfly,Dragonfly Naiad,Falcon,Giant Scorpion,Giant Scorpling" 2 (
            terrain=*^F*
            x=3-34
            y=13-38

            [not]
                radius=2
                find_in=secret_path
            [/not]

            [not]
                [filter]
                [/filter]
            [/not]

            [not]
                [filter_adjacent_location]
                    [filter]
                    [/filter]
                [/filter_adjacent_location]
            [/not]
        ) (
            side=4
            upkeep=loyal
            ai_special=guardian
        )}

        [objectives]
            side=1
            [objective]
                description= _ "Move Captain Mari or Deoran to the northern bank of the river"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Captain Mari"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Deoran"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Ethiliel"
                condition=lose
            [/objective]

            {TURNS_RUN_OUT}

            [gold_carryover]
                bonus=yes
                carryover_percentage=40
            [/gold_carryover]

            [note]
                description= _ "At the start of each turn, Ethiliel will reveal a path of flat road through the forest."
            [/note]
            [note]
                description= _ "The path that Ethiliel reveals will extend to the edge of her movement range from the end of the current path."
            [/note]
            [note]
                description= _ "It is advantageous to stay along the path that Ethiliel reveals through the forest."
            [/note]
        [/objectives]
    [/event]

    [event]
        name=start

        [recall]
            id=Ethiliel
            x,y=18,41
        [/recall]
        [recall]
            id=Sir Gerrick
        [/recall]
        [recall]
            id=Minister Hylas
        [/recall]

        [message]
            speaker=Deoran
            message= _ "Forest, forest, forest! As far as the eye can see, it is all forest! We have been trudging through these woods for days!"
        [/message]

        [message]
            speaker=Mari
            message= _ "At least you have a horse..."
        [/message]

        [message]
            speaker=Deoran
            message= _ "I guess I should not be complaining. Coming from the plains I forget not everyone has a steed!"
        [/message]

        [message]
            speaker=Ethiliel
            message= _ "Persevere a bit longer. With the undead defeated, I can use my power to reveal a path through the forest to hasten your journey home."
        [/message]

        {MOVE_UNIT (id=Ethiliel) 18 39}

        [message]
            speaker=Mari
            message= _ "My legs thank you for the aid, my lady. But we should still proceed with caution. There could be anything hiding behind the cover of these dense trees."
        [/message]
    [/event]

    # This event stores the vision range of Ethiliel into
    # $ethiliel_movement_area and then reveals any parts of the secret path within
    # it.
    #
    # Note: the mechanism inside the loop is very fragile and the ordering of
    # the commands is important. Be sure to test thoroughly after making any
    # changes to it.
    [event]
        name=new turn
        first_time_only=no

        [store_unit]
            [filter]
                id=Ethiliel
            [/filter]

            kill=no
            variable=stored_Ethiliel
        [/store_unit]

        {VARIABLE ethiliel_movement_area.x $stored_Ethiliel.x}
        {VARIABLE ethiliel_movement_area.y $stored_Ethiliel.y}

        {VARIABLE ethiliel_moves $stored_Ethiliel.max_moves}

        [while]
            [variable]
                name=ethiliel_moves
                greater_than=0
            [/variable]

            [do]
                [store_locations]
                    find_in=delayed_2_mp_hexes

                    variable=previous_2_mp_hexes
                [/store_locations]

                [store_locations]
                    terrain=*^F*,Hh,Ss,Ww

                    [filter_adjacent_location]
                        find_in=ethiliel_movement_area
                    [/filter_adjacent_location]

                    [not]
                        find_in=ethiliel_movement_area
                    [/not]

                    [not]
                        find_in=secret_path
                    [/not]

                    [not]
                        find_in=previous_2_mp_hexes
                    [/not]

                    variable=delayed_2_mp_hexes
                [/store_locations]

                [store_locations]
                    find_in=ethiliel_movement_area
                    radius=1

                    [filter_radius]
                        terrain=R*^*,Gg,C*,K*,*^V*

                        [or]
                            terrain=*^F*
                            find_in=secret_path
                        [/or]
                    [/filter_radius]

                    variable=ethiliel_movement_area
                [/store_locations]

                [store_locations]
                    find_in=ethiliel_movement_area

                    [or]
                        find_in=previous_2_mp_hexes
                    [/or]

                    variable=ethiliel_movement_area
                [/store_locations]

                {CLEAR_VARIABLE previous_2_mp_hexes}

                {VARIABLE_OP ethiliel_moves sub 1}
            [/do]
        [/while]

        # extend the movement area by one to expand the area to represent the
        # vision range instead
        [store_locations]
            find_in=ethiliel_movement_area
            radius=1

            variable=ethiliel_movement_area
        [/store_locations]

        # marks the area visibly on the map, useful for debugging
        #[foreach]
        #    array=ethiliel_movement_area
        #    [do]
        #        [label]
        #            x,y=$this_item.x,$this_item.y
        #            text=$turn_number
        #        [/label]
        #    [/do]
        #[/foreach]

        # store all yet unrevealed hidden road hexes within the area and reveal
        # them
        [store_locations]
            [not]
                terrain=R*^*
            [/not]
            y=10-37
            find_in=ethiliel_movement_area

            [and]
                find_in=secret_path
            [/and]

            variable=secret_path_to_reveal
        [/store_locations]

        [store_locations]
            find_in=secret_path_unrevealed

            [not]
                find_in=secret_path_to_reveal
            [/not]

            variable=secret_path_unrevealed
        [/store_locations]

        [if]
            [variable]
                name=secret_path_unrevealed.length
                greater_than=0
            [/variable]
            [then]
                [scroll_to_unit]
                    id=Ethiliel
                [/scroll_to_unit]
            [/then]
        [/if]
        [foreach]
            array=secret_path_to_reveal
            [do]
                [terrain]
                    x,y=$this_item.x,$this_item.y
                    terrain=Re
                [/terrain]
            [/do]
        [/foreach]

        [redraw]
        [/redraw]

        {CLEAR_VARIABLE ethiliel_movement_area,delayed_2_mp_hexes,previous_2_mp_hexes,secret_path_to_reveal,stored_Ethiliel}
    [/event]

    # Removing ambush ability, so it's really only one-time usable.
    # And moving the unit from the dummy side to the active one.

    [event]
        name=moveto
        first_time_only=no
        delayed_variable_substitution=yes

        [filter]
            side=1

            [filter_adjacent]
                side=3
            [/filter_adjacent]
        [/filter]

        # Moving from inactive elves side to active side

        [modify_unit]
            [filter]
                side=3
                [filter_location]
                    [filter_adjacent_location]
                        x,y=$x1,$y1
                    [/filter_adjacent_location]
                [/filter_location]
            [/filter]

            side=2
        [/modify_unit]

        [remove_object]
            [filter_location]
                [filter_adjacent_location]
                    x,y=$x1,$y1
                [/filter_adjacent_location]
            [/filter_location]
            object_id=one_time_ambush
        [/remove_object]

        # Explicitly firing other event, instead of having it as another moveto
        # event, guarantees, that it happens after switching the unit's side.

        [fire_event]
            name=flavor
            [primary_unit]
                id=$unit.id
            [/primary_unit]
        [/fire_event]
    [/event]

    # Flavor text for a subset of these units.
    # Using role for filtering allows to skip a case (see next comment).

    [event]
        name=flavor

        [filter]
            side=1

            [filter_adjacent]
                role=ambusher
                race=elf
            [/filter_adjacent]
        [/filter]

        # Ambushers have been placed with a minimum distance of 2 or 3 from each other.
        # We avoid the situation that the next dialogue is triggered by an ambusher very close.
        # These dialogues should hold for a while, not being used up directly at the beginning of the game.

        [modify_unit]
            [filter]
                role=ambusher
                race=elf
                [filter_location]
                    x,y=$x1,$y1
                    radius=5
                [/filter_location]
            [/filter]

            role=""
        [/modify_unit]

        [message]
            race=elf
            [filter_location]
                [filter_adjacent_location]
                    x,y=$x1,$y1
                [/filter_adjacent_location]
            [/filter_location]
            message= _"Humans! Vile beasts! You kidnapped and slew the Sage Mebrin!"
        [/message]
        [message]
            id=Deoran
            message= _"We did no such thing! He adopted the dark arts of his own volition. He was consumed by it and twisted into a being of great evil!"
        [/message]
        [message]
            [filter_location]
                [filter_adjacent_location]
                    x,y=$x1,$y1
                [/filter_adjacent_location]
            [/filter_location]
            message= _"How dare you! To accuse our beloved sage of such things... does the stupidity of humanity know no bounds?"
        [/message]
        [message]
            id=Ethiliel
            message= _"The human speaks the truth. As much as my heart grieves for Mebrin, he was not innocent either."
        [/message]
        [message]
            [filter_location]
                [filter_adjacent_location]
                    x,y=$x1,$y1
                [/filter_adjacent_location]
            [/filter_location]
            message= _"Fine words for a traitor."
        [/message]
        [message]
            id=Ethiliel
            image=portraits/ethiliel-mad.webp
            message= _"You dare speak to me so? Have you forgotten who I am? I <i>order</i> you to stand down this instant, warrior!"
        [/message]
        [message]
            [filter_location]
                [filter_adjacent_location]
                    x,y=$x1,$y1
                [/filter_adjacent_location]
            [/filter_location]
            message= _"Your orders no longer hold any weight, friend of the tree-killers. If you will not withdraw, we will kill you along with them!"
        [/message]
        [message]
            id=Deoran
            message= _"<i>My lady, what in the world is going on?</i>"
        [/message]
        [message]
            id=Ethiliel
            message= _"<i>I am not sure. Mebrin was beloved by many of our people. His death must have angered some of them greatly, perhaps to the point that they have become utterly irrational.</i>"
        [/message]
        [message]
            id=Deoran
            message= _"<i>But to be enraged to the point of even attacking you? You have the right to be the most angry of all, yet even you have made peace with us.</i>"
        [/message]
        [message]
            id=Ethiliel
            message= _"<i>My heart aches with too much grief for me to be angry any longer. But, I am afraid the rest of my people did not see firsthand what Mebrin had become.</i>"
        [/message]
        [message]
            id=Mari
            message= _"<i>I don’t think we can talk things out at this point.</i>"
        [/message]
        [message]
            id=Deoran
            message= _"<i>Then what should we do?</i>"
        [/message]
        [message]
            id=Ethiliel
            message= _"<i>Fight past our foes, but if possible, fight to subdue and not to kill. We elves have suffered enough from this ordeal. I would not have our people be slaughtered needlessly as well.</i>"
        [/message]
        [message]
            id=Mari
            message= _"<i>Very well. We can do that for now, but this is definitely something we need to resolve once we get back to Westin...</i>"
        [/message]

        [event]
            name=flavor
            delayed_variable_substitution=yes

            [filter]
                side=1

                [filter_adjacent]
                    role=ambusher
                    race=elf
                [/filter_adjacent]
            [/filter]

            [modify_unit]
                [filter]
                    role=ambusher
                    race=elf
                    [filter_location]
                        x,y=$x1,$y1
                        radius=5
                    [/filter_location]
                [/filter]

                role=""
            [/modify_unit]

            [message]
                race=elf
                [filter_location]
                    [filter_adjacent_location]
                        x,y=$x1,$y1
                    [/filter_adjacent_location]
                [/filter_location]
                message= _ "Humans, bandits and abductors! Prepare to be slain!"
            [/message]
            [message]
                speaker=Deoran
                message= _ "We don’t want to fight you! We wish only to return to our homes!"
            [/message]
            [message]
                race=elf
                [filter_location]
                    [filter_adjacent_location]
                        x,y=$x1,$y1
                    [/filter_adjacent_location]
                [/filter_location]
                message= _ "And so does our Sage Mebrin, yet you have not returned him to us! Even if you did, we would still dispatch of you for your heinous transgressions, you treacherous scum!"
            [/message]
        [/event]
    [/event]

    # flavor to show that we are subduing, not killing the elves
    [event]
        name=last breath
        first_time_only=no
        [filter]
            side=2
        [/filter]

        [store_unit]
            [filter]
                x,y=$x1,$y1
            [/filter]

            kill=no
            variable=subdued_unit
        [/store_unit]

        [fire_event]
            name=subdue_not_kill
        [/fire_event]

        {CLEAR_VARIABLE subdued_unit}

        [kill]
            x,y=$x1,$y1
            animate=no
        [/kill]
    [/event]

    [event]
        name=subdue_not_kill
        first_time_only=yes

        [message]
            x,y=$subdued_unit.x,$subdued_unit.y
            message= _ "Go on, then. Slay me like you murdered our revered Sage Mebrin."
        [/message]

        [message]
            id=Ethiliel
            message= _"Enough is enough. These humans are different than the scum who kidnapped Mebrin. They seek to make peace and will not hurt you. Stand down and return home."
        [/message]

        [message]
            x,y=$subdued_unit.x,$subdued_unit.y
            message= _ "... Fine. I just hope that your trust in these humans does not betray you."
        [/message]
    [/event]

    [event]
        name=time over

        [remove_shroud]
            [filter_side]
                side=1
            [/filter_side]
            x=16-23
            y=0-5
        [/remove_shroud]
        [lift_fog]
            [filter_side]
                side=1
            [/filter_side]
            x=16-23
            y=0-5
            multiturn=yes
        [/lift_fog]
        [redraw]
            side=1
            clear_shroud=yes
        [/redraw]

        [unit]
            type=Elvish Outrider
            side=3
            id=Eltenmir
            name= _ "Eltenmir"
            animate=yes
            x,y=20,1
        [/unit]
        {GENERIC_UNIT 3 (Elvish Hero) 19 2}
        {GENERIC_UNIT 3 (Elvish Captain) 21 2}
        {GENERIC_UNIT 3 (Elvish Marksman) 19 1}
        {GENERIC_UNIT 3 (Elvish Druid) 21 1}

        [message]
            speaker=Eltenmir
            message= _ "These human beasts slew our people and murdered the great Sage Mebrin! We must have vengeance for this vile atrocity!"
        [/message]

        [message]
            speaker=Mari
            message= _ "I don’t think we’re getting out of this one alive..."
        [/message]

        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    # Exiting the forest.

    [event]
        name=moveto
        [filter]
            id=Deoran
            y=1-6

            [filter_location]
                [not]
                    terrain=W*
                [/not]
            [/filter_location]
        [/filter]
        [message]
            speaker=Deoran
            message= _ "At last we have escaped that awful forest! Onwards toward Westin!"
        [/message]

        [endlevel]
            result=victory
            bonus=yes
            {NEW_GOLD_CARRYOVER 40}
        [/endlevel]
    [/event]

    [event]
        name=moveto
        [filter]
            id=Mari
            y=1-6

            [filter_location]
                [not]
                    terrain=W*
                [/not]
            [/filter_location]
        [/filter]
        [message]
            speaker=Mari
            message= _ "My legs hurt so bad... when we get back to Westin, I’m definitely going into hibernation for a week."
        [/message]

        [endlevel]
            result=victory
            bonus=yes
            {NEW_GOLD_CARRYOVER 40}
        [/endlevel]
    [/event]

    [event]
        name=victory

        [if]
            {VARIABLE_CONDITIONAL turn_number less_than 13}
            [then]
                [set_achievement]
                    content_for=The_South_Guard_Revised
                    id=tsg_s05
                [/set_achievement]
            [/then]
        [/if]

        {CLEAR_VARIABLE secret_path}
        {CLEAR_VARIABLE first_undead_spawn_turn,ford_mask_x,num_of_ambushers,quick_spawn_types,random,ethiliel_moves,previous_path_hex,new_path_hex,secret_path_unrevealed}
    [/event]
[/scenario]
