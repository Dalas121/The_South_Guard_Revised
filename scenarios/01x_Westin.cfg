#textdomain wesnoth-tsg
[scenario]
    id=01x_Westin
    map_file=Westin_and_Surroundings.map
    name= _ "Westin Town"
    next_scenario=02_The_Aethenwood
    victory_when_enemies_defeated=no
    {EXPERIENCE_MODIFIER}
    
    {DEFAULT_SCHEDULE_MORNING}
    turns=-1

    {SCENARIO_MUSIC traveling_minstrels.ogg}
    {EXTRA_SCENARIO_MUSIC wanderer.ogg}
    
    {TSG_BIGMAP {JOURNEY_01X_NEW} }
    
    
    #######################################################################################################################################################
    #                                                                   DEFINE SIDES
    #######################################################################################################################################################
    #############################
    # DEORAN
    #############################
    [side]
        side=1
        controller=human
        no_leader=yes
        team_name=South_Guard
        user_team_name=_"South Guard"
        gold,income=0,-2
        recruit=Spearman,Bowman
        {CUSTOM_SG_FLAG}
        defeat_condition=never
        save_id=player_side
    [/side]
    
    #############################
    # FIORE
    #############################
    [side]
        side=2
        type=Master at Arms
        id=Fiore
        name= _ "Magistrate Fiore"
        facing=sw
        
        team_name=South_Guard
        user_team_name=_"Westin"
        controller=null
        color=wesred
        {CUSTOM_SG_FLAG}
        gold=0
        income=-2
        canrecruit=yes
        
        # Guards
        {GENERIC_UNIT 2 Spearman 33 4}
        {GENERIC_UNIT 2 Spearman 35 6}
        {GENERIC_UNIT 2 Bowman 21 2}
        {GENERIC_UNIT 2 Spearman 25 1}
        {GENERIC_UNIT 2 Spearman 11 7}
        {GENERIC_UNIT 2 Spearman 14 11}
        {GENERIC_UNIT 2 Spearman 15 12}
        {GENERIC_UNIT 2 Woodsman 28 18}
        {GENERIC_UNIT 2 Mage 27 6} {GENDER female}
        
        # Peasants
        {GENERIC_UNIT 2 Peasant 16 9}
        {GENERIC_UNIT 2 Peasant 19 9}
        {GENERIC_UNIT 2 Peasant 36 1}
        {GENERIC_UNIT 2 Peasant 11 1}
        {GENERIC_UNIT 2 Peasant 5 9}
        {GENERIC_UNIT 2 Peasant 10 21}
        {GENERIC_UNIT 2 Peasant 7 22}
        {GENERIC_UNIT 2 Peasant 11 27}
        {GENERIC_UNIT 2 Peasant 40 21}
        {GENERIC_UNIT 2 Peasant 43 24}
        {GENERIC_UNIT 2 Peasant 33 10}
        {GENERIC_UNIT 2 Woodsman 3 7}
        {GENERIC_UNIT 2 Woodsman 38 6}
        {GENERIC_UNIT 2 Peasant 30 18} # fisherman
        
        # Boats
        {GENERIC_UNIT 2 Boat 34  9} {FACING sw}
        {GENERIC_UNIT 2 Boat 34 10} {FACING sw}
        
        [unit]
            side,x,y,facing=2,31,8,se
            {SINGLEUNITWML_HYLAS}
        [/unit]
        [unit]
            side,x,y,facing=2,15,11,se
            {SINGLEUNITWML_GERRICK}
        [/unit]
    [/side]
    
    # give the statue it's own side, so that it's blue UI orb doesn't show up
    [side]
        side=3
        color=wesred
        no_leader=yes
        hidden=yes
    [/side]
    {STARTING_VILLAGES 2 50}
    
    #--------------------
    # TOWNSFOLK
    #--------------------
#define TOWNSFOLK X Y IMAGE
    {GENERIC_UNIT 2 (Townsfolk) {X} {Y}}
    [object]
        {FILTER x,y={X},{Y}}
        [effect]
            apply_to=image_mod
            add="O(0)~CROP(0,0,72,72)~BLIT(units/townsfolk/{IMAGE})"
        [/effect]
    [/object]
#enddef
    [event]
        name=prestart
        {TOWNSFOLK 26 4 scribe.png}
        {TOWNSFOLK 24 8 crier.png}
        {MODIFY_UNIT x,y=24,8 role crier}
        {MODIFY_UNIT x,y=24,8 name _"Town Crier"}
        {TOWNSFOLK 27 8 dandy.png}
        {TOWNSFOLK 28 10 noble+female.png}
        {TOWNSFOLK 30 11 madame.png}
        {TOWNSFOLK 30 10 noble.png}
        {TOWNSFOLK 26 7  worker.png}
        {TOWNSFOLK 29 8  worker+female.png}
        {TOWNSFOLK 32 15 worker.png}
        {TOWNSFOLK 29 15 worker+female.png}
        [modify_unit]
            {FILTER x,y=29,15} # have a second leader so the villages flags don't go away, but remove the leader icon
            canrecruit=yes
        [/modify_unit]
        [hide_unit]
            x,y=29,15 # for some reason Ic an't remove the overlay with apply_to=overlay, so just hide this guy instead
        [/hide_unit]
        
        [item]
            halo="units/statue-westin.png~FL()"
            x,y=31,9
        [/item]
        {PLACE_IMAGE halo/stairway.png 31 7}
        
        {PLACE_IMAGE scenery/temple1.png 28 5}
        {PLACE_IMAGE scenery/tent-fancy-red.png 24 13}
        {PLACE_IMAGE scenery/tent-shop-weapons.png 25 14}
        
        {PLACE_IMAGE items/archery-target-right.png 16 12}
        {PLACE_IMAGE items/archery-target-right.png 17 12}
        
        {BRAZIER_ILLUMINATION_MORNING 26 8}
        {BRAZIER_ILLUMINATION_MORNING 30 9} # I hope these aren't too complicated for new players...
        {BRAZIER_ILLUMINATION_MORNING 25 13}
        
        # this does prevent you from seeing unit traits (particularly Hylas's "slow"), but I think that's OK.
        # It serves as a clear indicator that this isn't a normal battle scenario
        [change_theme]
            theme=Cutscene_Minimal
        [/change_theme]
    [/event]
    
    
    
    
    
    #######################################################################################################################################################
    #                                                                    PLAY SCENARIO
    #######################################################################################################################################################
    [event]
        name=start
        
        #############################
        # RECALL DEORAN AND MARI
        #############################
        {DELAY 500}
        {RECALL_XY Deoran 43 3}
        {MODIFY_UNIT id=Deoran facing sw}
        {MOVE_UNIT id=Deoran 42 2}
        [unstore_unit]
            variable=stored_mari
            x,y=43,3
            animate=yes
        [/unstore_unit]
        {MODIFY_UNIT id=Mari facing sw}
        {CLEAR_VARIABLE stored_mari}  
        
        #############################
        # ARRIVAL AT WESTIN
        #############################
        [message]
            speaker=Deoran
            message= _ "So this is Westin! I must say, it feels more like a village than a provincial capital. Some of our stables back home are larger than the castle across the river!"
        [/message]
        [message]
            speaker=Mari
            message= _ "This whole province is still a frontier, and rather too lawless for my tastes. I suppose that’s why this new magistrate has called us in to help clean up the place — he wants to make a good impression when the king arrives."
        [/message]
        {MOVE_UNIT id=Deoran 31 6}
        {MOVE_UNIT id=Mari   32 5}
        {SCROLL_TO 30 8}
        
        #############################
        # MEETING FIORE
        #############################
        {DELAY 500}
        [message]
            speaker=Fiore
            message= _ "...yes, yes, I know it’s something of a problem, but you can hardly argue that—"
        [/message]
        [message]
            speaker=Minister Hylas
            message= _ "Magistrate—"
        [/message]
        [message]
            speaker=Fiore
            message= _ "—no intention of abandoning our crucial preparations here in town, preparations may I add that are of the utmost importance to securing royal investment in our little town—"
        [/message]
        [message]
            speaker=Minister Hylas
            message= _ "Magistrate."
        [/message]
        [message]
            speaker=Fiore
            #po: "snipe hunting" https://en.wikipedia.org/wiki/Snipe_hunt
            message= _ "—dropping everything just to spend days hunting snipe out in the hot muddy countryside with no guarantee of success, all while— huh?"
        [/message]
        [message]
            speaker=Minister Hylas
            message= _ "Magistrate, we have guests."
        [/message]
        [message]
            speaker=Fiore
            message= _ "Oh!"
        [/message]
        [message]
            speaker=Fiore
            message= _ "Guests! Is that the crest of Weldyn? Where are my manners! Welcome, welcome, you must be my sent-for reinforcements!"
        [/message]
        [message]
            speaker=Deoran
            message= _ "Captain Deoran, reporting for duty! I received your orders sir: reinforce Westin’s South Guard and keep the province safe and orderly! Ready to help."
        [/message]
        [message]
            speaker=Mari
            message= _ "And on that note, magistrate, we encountered a highly unusual bandit en route to town. His ruffians were of little threat to us, but he had the unusual skill of—"
        [/message]
        [message]
            speaker=Fiore
            message= _ "...raising the dead in a foul mockery of all that is good and right? Yes, yes, I’m already more than aware. A real nuisance I’m told. Look, the point is... how should I say it?"
        [/message]
        {SCROLL_TO 15 11}
        [message]
            speaker=Sir Gerrick
            message= _ "Yer keepin‘ Westin safe an‘ spotless fer the upcomin‘ nuptials, but the rest of the countryside is none o‘ your concern? It‘s true enough tha‘ there‘s a lot o‘ ground to guard, and ‘til now there‘s been only a few o‘ us to do the guardin‘."
        [/message]
        
        {SCROLL_TO 30 8}
        [message]
            speaker=Fiore
            message= _ "Well, I‘d hardly put it that way, but the outlying farms are— I mean, well, I might add that this is a very recent thing. The ability of these bandit gangs to use magic, I mean. And now that these newcomers have arrived we may finally have the mapower to—"
        [/message]
        {DELAY 500}
        
        #############################
        # MEETING ASHEVIERE
        #############################
        {FAKE_UNIT_MOVE 28 27 10 10  2 Asheviere ()}
        [unit]
            side,x,y,facing=2,27,10,nw
            {SINGLEUNITWML_ASHEVIERE}
        [/unit]
        {DELAY 500}
        {MODIFY_UNIT id=Fiore facing se}
        [message]
            speaker=Fiore
            message= _ "<b><i>Achem!</i></b> More importantly than any of that, why is my good-for-nothing daughter eavesdropping on military matters while she has a wedding to rehearse!"
        [/message]
        [message]
            speaker=Asheviere
            message= _ "I wasn‘t eavesdropping. And it‘s still months until—"
        [/message]
        [message]
            speaker=Fiore
            message= _ "Ah ah ah! Don‘t talk back to your father! You have no idea what sacrifices I had to make to line up your upcoming marriage with the king. I can‘t let alone for one minute without you wandering off, can I?"
        [/message]
        [message]
            speaker=Fiore
            message= _ "This wedding is going to make both me and you very influential people in the kingdom, so let us get back inside and resume rehearsals right where we left off."
        [/message]
        {MOVE_UNIT id=Asheviere 30 7} {PUT_TO_RECALL_LIST id=Asheviere}
        {MOVE_UNIT id=Fiore     30 7} {DELAY 500} {MODIFY_UNIT id=Fiore facing ne}
        {MOVE_UNIT id=Fiore     30 6}
        
        #############################
        # DEORAN GETS HIS ORDERS
        #############################
        [message]
            speaker=Fiore
            #po: Fiore doesn't remember Deoran's name
            message= _ "Deo— Deonin, was it? With your company reinforcing the South Guard we may finally have enough men to tackle this bandit necromancy problem, which which my advisors have so-often insisted must be taken seriously."
        [/message]
        [message]
            speaker=Fiore
            message= _ "Being a lieutenant, you are hereby formally tasked with doing so — I have the utmost confidence that you‘ll resolve the issue to perfection."
        [/message]
        {DELAY 250} {MOVE_UNIT id=Fiore 30 7} {DELAY 250}
        {PUT_TO_RECALL_LIST id=Fiore}
        [message]
            speaker=Deoran
            message= _ "—but wait, I just arrived. What exactly is the situation? Where am I supposed to start!?"
        [/message]
        {DELAY 1000}
        {RECALL_XY Fiore 30 7}
        {MOVE_UNIT id=Fiore 30 6}
        {DELAY 250}
        [message]
            speaker=Fiore
            message= _ "Oh, err... choose one of my advisors to accompany you, or maybe that Mari you shipped in with. March to battle, figure out how these outlaws learned to summon undead, and put a stop to it!"
        [/message]
        # I bribed away a pretty penny to get you and your company this far down south — don‘t make me regret it!
        # Oh, err... try speaking to some of the folks around town. Clever young lad like yourself, I‘m sure you‘ll figure something out!"
        {DELAY 250}
        {MOVE_UNIT id=Fiore 30 7}
        {DELAY 250}
        {PUT_TO_RECALL_LIST id=Fiore}
        
        #############################
        # PREPARE OBJECTIVES
        #############################
        {TELEPORT_UNIT id="Minister Hylas" 27 5}
        {TELEPORT_UNIT id=Mari  24 12}
        {MODIFY_UNIT id=Mari facing ne}
#define QUEST_MARKER X Y
        [item]
            x,y={X},{Y}
            image=misc/highlight-hex.png
            halo=misc/exclamation[01,01,02,02,03,03,04,04,05,05,06,06,07,07,08,08,09,09,10,10,10,10,09,09,08,08,07,07,06,06,05,05,04,04,03,03,02,02,01,01].png
        [/item]
#enddef
        {QUEST_MARKER 15 11}
        {QUEST_MARKER 24 12}
        {QUEST_MARKER 27 5}
        [disallow_end_turn]
            reason=_"To continue to the next scenario, speak to the highlighted units
(move nearby to trigger conversation) and choose one to accompany you.

Deoran has unlimited moves in this scenario."
        [/disallow_end_turn]
        
        #############################
        # OBJECTIVES
        #############################
        [objectives]
            [objective]
                description= _ "Speak to one or all of the highlighted units"+"
    "+_"(move nearby to trigger conversation)"+"
"
                condition=win
            [/objective]
            [objective]
                description= _ "Choose a companion to continue to the next scenario"
                condition=win
            [/objective]
        [/objectives]
    [/event]
    
    #############################
    # ALLOW THE PLAYER TO MOVE FREELY
    #############################
    [event]
        name=moveto,unit placed
        first_time_only=no
        {FILTER id=Deoran}
        [heal_unit]
            {FILTER id=Deoran}
            moves=full
            restore_attacks=yes
        [/heal_unit]
        [allow_undo]
        [/allow_undo]
    [/event]
    
    
    
    
    
    #######################################################################################################################################################
    #                                                                     ASHEVIERE
    #######################################################################################################################################################
    # before Asheviere, so the event triggers first
    [event]
        name=enter hex
        {FILTER( id,x,y=Deoran,31,7 )}
        [message]
            speaker=Deoran
            message= _ "This is the entrance to the town cellars. It’s full of food right now, but would make a great refuge for the population in case of emergency."
        [/message]
    [/event]
    [event]
        name=enter hex
        {FILTER( id=Deoran {FILTER_LOCATION x,y,radius=30,7,1} )}
        
        [cancel_action]
        [/cancel_action]
        {RECALL_XY Asheviere 30 7}
        [message]
            speaker=Deoran
            message= _ "Oh, hello again — we didn’t get a chance for a proper introduction earlier. It was Asheviere, wasn’t it?"
        [/message]
        [message]
            speaker=Deoran
            message= _ "I understand you’re the bride-to-be! You must be quite exceptional to have earned the affection of the king himself."
        [/message]
        [message]
            speaker=Asheviere
            message= _ "We’ve never met. I’ve only seen the statue. Fathe—"
        [/message]
        
        {RECALL_XY Fiore 31 8}
        [message]
            speaker=Fiore
            message= _ "What are you doing out here! You said you were just going to the kitchen for a drink! Tighten up that corset and get back inside, girl."
        [/message]
        {PUT_TO_RECALL_LIST id=Asheviere}
        {MOVE_UNIT id=Fiore 30 7}
        {PUT_TO_RECALL_LIST id=Fiore}
        
        [message]
            speaker=Deoran
            message= _ "What an odd town."
        [/message]
    [/event]
    
    
    
    
    
    #######################################################################################################################################################
    #                                                                      MINISTER HYLAS
    #######################################################################################################################################################
    [event]
        name=hylas_intro
        [message]
            speaker=Minister Hylas
            message= _ "Minister Hylas, local healer and archivist for the magistrate. Welcome to the South Guard, Deoran.

It is well that we are finally taking action against the strengthening outlaws. Banditry is one matter, but dark magic is something else entirely."
        [/message]
        [message]
            speaker=Minister Hylas
            message= _ "I understand you’ll be selecting either me, Sir Gerrick, or your acquaintance Mari to accompany you?"
        [/message]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        {FILTER( id=Deoran {FILTER_ADJACENT id="Minister Hylas"} )}
        
        {FIRE_EVENT hylas_intro}
        {VARIABLE msg_continue true}
        [while]
            [variable]
                name=msg_continue
                boolean_equals=true
            [/variable]
            [do]
                [message]
                    speaker=Deoran
                    [option]
                        label= _ "What skills and abilities do you have?"
                        [command]
                            [message]
                                speaker=Minister Hylas
                                message= _ "I am a healer, Deoran. The light within me can <i><b>heal adjacent units</b></i> for 8 hitpoints every turn. This doesn’t stack with healing from villages or other healers."
                            [/message]
                            [message]
                                speaker=Minister Hylas
                                message= _ "I also wield a powerful ranged <i><b>magical</b></i> attack. Magical attacks always have a 70% chance to hit, making them ideal against hard-to-hit enemies. And the <i><b>arcane damage type</b></i> I use is particularly effective against undead, though weaker against my fellow man."
                            [/message]
                            [fire_event]
                                name=explain unit descriptions
                            [/fire_event]
                        [/command]
                    [/option]
                    [option]
                        label= _ "What can you tell me about necromancy?"
                        [command]
                            [message]
                                speaker=Deoran
                                message= _ "I recognize the robes and staff of a white magi, Minister Hylas. I expect you know much about fighting the undead?"
                            [/message]
                            [message]
                                speaker=Minister Hylas
                                message= _ "Indeed. Such knowledge can be dangerous in the wrong hands, but those of my order have made it our life’s purpose to cure and protect — the very antithesis of necromancy."
                            [/message]
                            [message]
                                speaker=Minister Hylas
                                message= _ "The other races — especially elves — are said to maintain their own knowledge of these arts. The nearby Aethenwood is a great bastion of their kind, but I have retrettably never had the opportunity to visit."
                            [/message]
                        [/command]
                    [/option]
                    [option]
                        label= _ "What happened to your leg?"
                        [command]
                            [message]
                                speaker=Deoran
                                message= _ "I don’t mean to be rude, but... your leg looks badly injured. If you have healing magic, shouldn’t you be able to cure it?"
                            [/message]
                            [message]
                                speaker=Minister Hylas
                                message= _ "Born twisted, I’m afraid. At the time there was no healer in Westin, and the bones set poorly. Such was the greater part of my motivation for traveling to the Isle of Alduin and studying the arcane arts — an opportunity to return home and offer to others the services that I never had."
                            [/message]
                            [message]
                                speaker=Minister Hylas
                                message= _ "I’ve long-ago accepted my impairment, but as my potential commander, you should know that it does somewhat slow my movement on the battlefield."
                            [/message]
                        [/command]
                    [/option]
                    [option]
                        label= _ " "
                    [/option]
                    [option]
                        label= _ "I’m ready to leave, and I want you to accompany me. <i><b>(End Scenario)</b></i>"
                        [command]
                            [message]
                                speaker=Deoran
                                message= _ "I’ve decided. Minister Hylas, I’d like you to accompany me on our mission against the bandits. Where have they most recently attacked?"
                            [/message]
                            {MODIFY_UNIT (id=Minister Hylas) side 1}
                            {VARIABLE companion_id "Minister Hylas"}
                            {VARIABLE companion_name _"Minister Hylas"}
                            {VARIABLE msg_continue false}
                            [endlevel]
                                result=victory
                                bonus=no
                                {NEW_GOLD_CARRYOVER 100}
                            [/endlevel]
                        [/command]
                    [/option]
                    [option]
                        label= _ "I don’t have anything else to ask."
                        [command]
                            {VARIABLE msg_continue false}
                        [/command]
                    [/option]
                [/message]
            [/do]
        [/while]
        {CLEAR_VARIABLE msg_continue}
    [/event]
    
    
    
    
    
    #######################################################################################################################################################
    #                                                                     SIR GERRICK
    #######################################################################################################################################################
    [event]
        name=gerrick_intro
        [message]
            speaker=Sir Gerrick
            message= _ "Hail! I’m Sir Gerrick, infantry commander o’ the South Guard an’ advisor to the magistrate."
        [/message]
        [message]
            speaker=Sir Gerrick
            message= _ "I understand you’ll be choosin’ one o’ us to fight with you ’gainst the outlaws? Either me, Minister Hylas, or that Mari o’ yers will be the best options."
        [/message]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        {FILTER( id=Deoran {FILTER_ADJACENT id="Sir Gerrick"} )}
        
        {FIRE_EVENT gerrick_intro}
        {VARIABLE msg_continue true}
        [while]
            [variable]
                name=msg_continue
                boolean_equals=true
            [/variable]
            [do]
                [message]
                    speaker=Deoran
                    [option]
                        label= _ "What skills and abilities do you have?"
                        [command]
                            [message]
                                speaker=Sir Gerrick
                                message= _ "Some think my heavy armor to be slow an’ cumbersome, but it also gives me great <i><b>resistance</b></i> against bladed or piercing weapons. If you need someone t’ hold a line, I’m your man."
                            [/message]
                            [message]
                                speaker=Sir Gerrick
                                message= _ "And while I fight better ’n most with a glaive, my best attack is my shield bash fer it’s <i><b>slow</b></i>in’ effect. Slowed enemies move at half speed, an’ also deal <i><b>half damage</b></i>!"
                            [/message]
                            [fire_event]
                                name=explain unit descriptions
                            [/fire_event]
                        [/command]
                    [/option]
                    [option]
                        label= _ "Have these bandit gangs ever attacked Westin?"
                        [command]
                            [message]
                                speaker=Deoran
                                message= _ "Sir Gerrick, has Westin itself ever been attacked? With bandits so bold as to attack me and Mari on our journey here, a threat to Westin certainly appears a possibility. The magistrate seems very concerned with impressing the king at his daughter’s wedding, but perhaps less so about security..."
                            [/message]
                            [message]
                                speaker=Sir Gerrick
                                message= _ "No sir, those outlaws wouldn’t dare. Say what you will about Fiore an‘ the long road here, but at least he keeps th‘ town itself runnin‘ smooth an‘ safe. I hear he spent a pretty penny in bribes to get you and your company called in."
                            [/message]
                            [message]
                                speaker=Sir Gerrick
                                message= _ "We may be nothin‘ compared to a proper fortress like Halstead or the capitol at Weldyn, but it‘d take a lot more bandits than we‘ve seen so far to threaten the townsfolk here. An‘ with you huntin‘ them outlaws down afore they can grow strong, I don‘t expect that‘ll ever happen."
                            [/message]
                        [/command]
                    [/option]
                    [option]
                        label= _ "What do you know of the nearby elves?"
                        [command]
                            [message]
                                speaker=Deoran
                                message= _ "I remember from Mari’s maps that the Aethenwood is not far from here. How are relationships with the forest‘s elves?"
                            [/message]
                            [message]
                                speaker=Sir Gerrick
                                message= _ "Could be better, could be worse. We don’ bother them, they don’ bother us. Good thing too; I hear they outnumber us by quite a bit! Rumor has it them elves don’ like outsiders much."
                            [/message]
                            [message]
                                speaker=Sir Gerrick
                                message= _ "Although, they did send a messenger some months ago regarding— ...well, I’ll tell you ’bout that later."
                            [/message]
                        [/command]
                    [/option]
                    [option]
                        label= _ " "
                    [/option]
                    [option]
                        label= _ "I’m ready to leave, and I want you to accompany me. <i><b>(End Scenario)</b></i>"
                        [command]
                            [message]
                                speaker=Deoran
                                message= _ "I’ve decided. Sir Gerrick, I’d like you to accompany me on our mission against the bandits. Where have they most recently attacked?"
                            [/message]
                            {MODIFY_UNIT (id=Sir Gerrick) side 1}
                            {VARIABLE companion_id "Sir Gerrick"}
                            {VARIABLE companion_name _"Sir Gerrick"}
                            {VARIABLE msg_continue false}
                            [endlevel]
                                result=victory
                                bonus=no
                                {NEW_GOLD_CARRYOVER 100}
                            [/endlevel]
                        [/command]
                    [/option]
                    [option]
                        label= _ "I don’t have anything else to ask."
                        [command]
                            {VARIABLE msg_continue false}
                        [/command]
                    [/option]
                [/message]
            [/do]
        [/while]
        {CLEAR_VARIABLE msg_continue}
    [/event]
    
    
    
    
    
    #######################################################################################################################################################
    #                                                                    MARI INTERACTIONS
    #######################################################################################################################################################
    [event]
        name=mari_intro
        [message]
            speaker=Mari
            message= _ "Hey, rookie. How’re you liking the town? I’m all out of quintains, so if you want more bruises you’ll have to find another inanimate object to fight."
        [/message]
        [message]
            speaker=Mari
            message= _ "I heard Fiore order you after the bandits, and also heard you’re picking an officer to help out. I’m open if you need me, or you could try the locals: “Minister Hylas” and “Sir Gerrick.”"
        [/message]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        {FILTER( id=Deoran {FILTER_ADJACENT id=Mari} )}
        
        {FIRE_EVENT mari_intro}
        [fire_event]
            name=mari_intro
        [/fire_event]

        {VARIABLE msg_continue true}
        [while]
            [variable]
                name=msg_continue
                boolean_equals=true
            [/variable]
            [do]
                [message]
                    speaker=Deoran
                    [option]
                        label= _ "What skills and abilities do you have?"
                        [command]
                            [message]
                                speaker=Mari
                                message= _ "I’m a survivor. Fast-moving, light on my feet. And impossible to pin down, because my <i><b>skirmisher</b></i> ability lets me move freely around enemies, whether to attack or to escape."
                            [/message]
                            [message]
                                speaker=Mari
                                message= _ "I may not have the supportive abilities of Hylas or Gerrick, but I’ll bet I could beat either of them in a 1-on-1. And you too, but that goes without saying."
                            [/message]
                            [fire_event]
                                name=explain unit descriptions
                            [/fire_event]
                        [/command]
                    [/option]
                    [option]
                        label= _ "Any idea how that bandit learned to raise the dead?"
                        [command]
                            [message]
                                speaker=Deoran
                                message= _ "Mari, you mentioned you’d fought the undead before. Any idea how that bandit learned to practice necromancy?"
                            [/message]
                            [message]
                                speaker=Mari
                                message= _ "Not a clue. Back in the Estmarks we never even saw the necromancer, just her messy results. There were only ever a few undead, but that was more than enough for my little band..."
                            [/message]
                            [message]
                                speaker=Mari
                                message= _ "<b><i>These</i></b> bandits might’ve been trained by a dark wizard, might’ve figured it out on their own, might’ve stumbled on some old artifact... Who knows."
                            [/message]
                        [/command]
                    [/option]
                    [option]
                        label= _ "Are you going to keep making me do all the fighting?"
                        [command]
                            [message]
                                speaker=Deoran
                                message= _ "Do you actually... <b><i>want</i></b> to be here? You’ve been nothing but irritated ever since we first met. And you didn’t even try to fight those bandits."
                            [/message]
                            [message]
                                speaker=Mari
                                message= _ "Yeah... Just thought I was done with all this after losing my arm in the Estmarks. But it turns out pity doesn’t put food on the table."
                            [/message]
                            [message]
                                speaker=Mari
                                message= _ "If you’re asking whether I’ll fight properly next time: yeah, I will. A handful of bandits are no threat to a company of trained soldiers, but bandits summoning undead are serious business."
                            [/message]
                        [/command]
                    [/option]
                    [option]
                        label= _ " "
                    [/option]
                    [option]
                        label= _ "I’m ready to leave, and I want you to accompany me. <i><b>(End Scenario)</b></i>"
                        [command]
                            [message]
                                speaker=Deoran
                                message= _ "I’ve decided. Sergeant Mari, I’d like you to accompany me on our quest against the bandits. Do you have any ideas on how we should begin?"
                            [/message]
                            {MODIFY_UNIT (id=Mari) side 1}
                            {VARIABLE companion_id Mari}
                            {VARIABLE companion_name _"Sergeant Mari"}
                            {VARIABLE msg_continue false}
                            [endlevel]
                                result=victory
                                bonus=no
                                {NEW_GOLD_CARRYOVER 100}
                            [/endlevel]
                        [/command]
                    [/option]
                    [option]
                        label= _ "I don’t have anything else to ask."
                        [command]
                            {VARIABLE msg_continue false}
                        [/command]
                    [/option]
                [/message]
            [/do]
        [/while]
        
        {CLEAR_VARIABLE msg_continue}
    [/event]
    
    
    
    
    
    #######################################################################################################################################################
    #                                                                     MISC
    #######################################################################################################################################################
    [event]
        name=victory
        
        {SAY_COMPANION
            MESSAGE_MARI=_"Yeah, figures I’d get picked. Look, I’m not an expert, but I’ve been chattin’ up the locals — they say that some months ago, one of those Aethenwood elves came to Westin. He asked that the magistrate accompany him back to their home, to discuss a new threat."
            MESSAGE_GERRICK=_"Southport, it was. But I’ve got a better lead: the Aethenwood. Some months ago, afore the bandit raids began, one o’ them elves came to Westin sayin’ his bosses had somethin’ important to talk about. They wanted Fiore to go to th’ Aethenwood."
            MESSAGE_HYLAS=_"Southport — but we may have a more promising lead. Some months ago, before the bandit raids began, an ambassador came to Westin from the elves of the Aethenwood. He asked that the magistrate accompany him back to their home, to discuss a budding threat."
        }
        [message]
            speaker=Deoran
            message= _ "What did the elves have to say?"
        [/message]
        {SAY_COMPANION
            MESSAGE_MARI=_"Fiore never went — no surprise there. But if the elves know something, then we ought to know it too."
            MESSAGE_GERRICK=_"Don’ ask me; Fiore didn’t go. Too busy with weddin’ stuff, or somethin’ like that. But if you an’ I want t’ beat these bandits, I say we start by speakin’ to th’ elves."
            MESSAGE_HYLAS=_"I do not know, for Magistrate Fiore would not spare time to go. But if we wish to learn how these bandits studied their dark art, I suggest we travel west and counsel with the elves."
        }
        [message]
            speaker=Deoran
            message= _ "Wise advice, $companion_name. My training was on how to fight the living, not the dead — we may need help to defeat foes as unnatural as these. Let us meet with the elves and hope their counsel will be of aid."
        [/message]
    [/event]
    
    
    #############################
    # EXPLAIN UNIT DESCRIPTIONS
    #############################
    [event]
        name=explain unit descriptions
        [display_tip]
            title=_"Unit Descriptions"
            image=tutor/unit_description.png
            message=_"To see details about a particular unit,
right click on it and select “Unit Description”.

A unit’s description shows it’s basic stats,
as well as any special abilities or damage
resistances it possesses."
        [/display_tip]
    [/event]
    
    #############################
    # OTHER MISC
    #############################
    [event]
        name=enter hex
        [filter]
            side=1
            [filter_location]
                x,y,radius=30,18,1
                {OR( x,y,radius=32,15,1 )}
                {OR( x,y,radius=33,10f,1 )}
            [/filter_location]
        [/filter]
        [cancel_action]
        [/cancel_action]
        [message]
            level=0 {FILTER_ADJACENT id=Deoran}
            #po: What do you want? Can't you see I'm busy fishing?!
            message= _ "Whadyya wan’? Can’tcha see I’m busy fishin’?!"
        [/message]
    [/event]
    [event]
        name=enter hex
        {FILTER( {FILTER_ADJACENT role=crier} )}
        [cancel_action]
        [/cancel_action]
        [message]
            role=crier
            message= _ "Listen one, listen all! New arrival from the north promises an end to countryside bandit woes! Salvation for the outer farms, or are we kicking the hornet’s nest?"
        [/message]
        [message]
            speaker=Deoran
            message= _ "I’ll do my best."
        [/message]
    [/event]
    [event]
        name=enter hex
        {FILTER( 
            x,y=4-16,18-26 {FILTER_ADJACENT side=2}
            {OR( {FILTER_ADJACENT x,y=16,9} )}
            {OR( {FILTER_ADJACENT x,y=19,9} )}
            {OR( {FILTER_ADJACENT x,y=5,9} )}
        )}
        [cancel_action]
        [/cancel_action]
        [message]
            speaker=Deoran
            message= _ "Hello there, farmer."
        [/message]
        [message]
            side=2 {FILTER_ADJACENT id=$unit.id}
            message= _ "’ello, soldier."
        [/message]
        [message]
            speaker=Deoran
            message= _ "...carry on."
        [/message]
    [/event]
    [event]
        name=enter hex
        {FILTER( {FILTER_LOCATION x,y,radius=31,9,1} )}
        [cancel_action]
        [/cancel_action]
        [message]
            speaker=Deoran
            message= _ "This statue is in the likeness of a tall man with a crown upon his brow. He is Garard II, the current king of Wesnoth and my liege lord."
        [/message]
        [message]
            speaker=Sir Gerrick
            message= _ "Th’ magistrate had that ’un built special, just a few months ago."
        [/message]
    [/event]
    
    [event]
        name=moveto
        {FILTER( {FILTER_LOCATION terrain=Ww} )} # not Ww^Bw bridges
        [message]
            speaker=Deoran
            message= _ "Horses don’t make great swimmers, but at least the water isn’t very deep here."
        [/message]
    [/event]
    [event]
        name=moveto
        {FILTER( {FILTER_LOCATION terrain=*^Gvs} {NOT({FILTER_ADJACENT id="Sir Gerrick"})} )}
        [message]
            speaker=Deoran
            message= _ "I’ve always wondered what life would be like as a farmer. Back home on the plains, all the land is used for grazing."
        [/message]
    [/event]
    [event]
        name=moveto
        {FILTER( {FILTER_LOCATION terrain=Ce*^*} )}
        [message]
            speaker=Deoran
            message= _ "A wooden palisade. More attention seems to have been paid to its appearance than its function."
        [/message]
    [/event]
    
    
    [event]
        name=moveto
        {FILTER( x,y=0-5,0-25 )}
        [message]
            speaker=Deoran
            message= _ "The Aethenwood is several days’ march in this direction. They say an elvish kingdom lies within, though few who enter there return."
        [/message]
    [/event]
    [event]
        name=moveto
        {FILTER( x,y=0-99,26-99 )}
        [message]
            speaker=Deoran
            message= _ "The hamlet of Southport is down this way. From what I hear, it’s even smaller than Westin."
        [/message]
    [/event]
    [event]
        name=moveto
        {FILTER( {FILTER_LOCATION x,y,radius=43,2,2} )}
        [message]
            speaker=Deoran
            message= _ "I’m no deserter. Magistrate Fiore has given me an assignment, and I intend to carry it out."
        [/message]
    [/event]
[/scenario]
