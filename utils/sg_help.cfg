#textdomain wesnoth-tsg

#define TUTORIAL_ENABLE_CONDITION
    [filter_condition]
        [variable]
            name=enable_tutorial_elements
            boolean_equals=yes
        [/variable]
    [/filter_condition]
#enddef

#I don't know why but if I just put these in here as is, they somehow don't get added to the scenarios so they never get triggered
#define SIDE_ONE_DESCRIPTIONS
    [event]
        name=select
        [filter]
            type=Spearman
        [/filter]
        {TUTORIAL_ENABLE_CONDITION}
        [if]
            [variable]
                name=sg_spearman_info
                boolean_equals=no
            [/variable]
            [then]
                [set_variable]
                    name=sg_spearman_info
                    value=yes
                [/set_variable]
                [message]
                    speaker=narrator
                    image="units/human-loyalists/spearman-attack-ranged1.png~RC(magenta>red)"
                    {TUTOR: _"Spearmen are the backbone of loyalist armies and are excellent all-round frontliners with strong damage and good durability. They have the <i>lawful</i> alignment, which means they are much more powerful during the day and lose damage at night."}
                [/message]
            [/then]
        [/if]
    [/event]

    [event]
        name=select
        [filter]
            type=Bowman
        [/filter]
        {TUTORIAL_ENABLE_CONDITION}
        [if]
            [variable]
                name=sg_bowman_info
                boolean_equals=no
            [/variable]
            [then]
                [set_variable]
                    name=sg_bowman_info
                    value=yes
                [/set_variable]
                [message]
                    speaker=narrator
                    image="units/human-loyalists/bowman-bow-attack-2.png~RC(magenta>red)"
                    {TUTOR: _"Bowmen are the secondary units in loyalist armies, with <i>ranged</i> attacks that cannot be retaliated against by units with only <i>melee</i> attacks."}
                [/message]
            [/then]
        [/if]
    [/event]

    [event]
        name=post_advance
        [filter]
            side=1
            type=Horseman Commander
        [/filter]
        {TUTORIAL_ENABLE_CONDITION}

        [message]
            speaker=unit
            message= _ "Advancing a level has fully healed me! I have now gained the <i>leadership</i> ability, which raises the fighting spirit of less experienced troops adjacent to me and causes their attacks to deal more damage."
        [/message]
    [/event]

    [event]
        name=post_advance
        [filter]
            side=1
            type=Mounted Officer
        [/filter]
        {TUTORIAL_ENABLE_CONDITION}

        [message]
            speaker=unit
            message= _ "Advancing a level has fully healed me again! While I have not gained any new abilities, I have increased damage and hitpoints, and can now <i>lead</i> level 2 units adjacent to me."
        [/message]
    [/event]

    [event]
        name=post_advance
        [filter]
            side=1
            type=TSG Guard Captain
        [/filter]
        {TUTORIAL_ENABLE_CONDITION}

        [message]
            speaker=unit
            message= _ "You know what they say, wash away the mental pains with training gains. I’m so big and strong now. No seriously, did you want a detailed description of what I can do after advancing? Right click me and select <b>Unit Description</b> or press <b>d</b> when hovering over me and you can learn everything you want to know."
        [/message]
    [/event]
#enddef

[event]
    name=attack
    [filter]
        type=Thug
    [/filter]
    [filter_second]
        side=1
    [/filter_second]
    {TUTORIAL_ENABLE_CONDITION}
    [if]
        [variable]
            name=sg_thug_info
            boolean_equals=no
        [/variable]
        [then]
            [set_variable]
                name=sg_thug_info
                value=yes
            [/set_variable]
            [message]
                speaker=narrator
                image="units/human-outlaws/thug-melee-3.png~RC(magenta>red)"
                {TUTOR: _"Thugs are the mainstay of the bandit rings. They are powerful in melee combat, but do not have a <i>ranged</i> attack and are vulnerable to archers. Like all outlaw units, they are much more dangerous at night due to having the <i>chaotic</i> alignment."}
            [/message]
        [/then]
    [/if]
[/event]

[event]
    name=attack
    [filter]
        type=Thief
    [/filter]
    [filter_second]
        side=1
    [/filter_second]
    {TUTORIAL_ENABLE_CONDITION}
    [if]
        [variable]
            name=sg_thief_info
            boolean_equals=no
        [/variable]
        [then]
            [set_variable]
                name=sg_thief_info
                value=yes
            [/set_variable]
            [message]
                speaker=narrator
                image="units/human-outlaws/thief-defend-2-2.png~RC(magenta>red)"
                {TUTOR: _"Thieves are weak in one-on-one combat, but can be deadly if you allow them to surround your units. On offense, thieves will deal double damage when they have an ally directly behind the unit they are attacking! Like thugs, thieves are vulnerable to ranged attacks."}
            [/message]
        [/then]
    [/if]
[/event]

[event]
    name=attack
    [filter]
        type=Footpad
    [/filter]
    [filter_second]
        side=1
    [/filter_second]
    {TUTORIAL_ENABLE_CONDITION}
    [if]
        [variable]
            name=sg_footpad_info
            boolean_equals=no
        [/variable]
        [then]
            [set_variable]
                name=sg_footpad_info
                value=yes
            [/set_variable]
            [message]
                speaker=narrator
                image="units/human-outlaws/footpad+female-attack1.png~RC(magenta>red)"
                {TUTOR: _"Footpads are the scouts of the bandit rings. They are highly mobile, and have both a <i>melee</i> attack and a <i>ranged</i> attack, although neither of their attacks is very strong. Footpads are difficult to hit with regular attacks, but will take bonus damage from <i>blade</i>, <i>impact</i>, or <i>pierce</i> weapons and can be easily killed during the day."}
            [/message]
        [/then]
    [/if]
[/event]

[event]
    name=attack
    [filter]
        type=Skeleton, Skeleton Archer
    [/filter]
    [filter_second]
        side=1
    [/filter_second]
    {TUTORIAL_ENABLE_CONDITION}
    [if]
        [variable]
            name=sg_skeleton_info
            boolean_equals=no
        [/variable]
        [then]
            [set_variable]
                name=sg_skeleton_info
                value=yes
            [/set_variable]
            [message]
                speaker=narrator
                image="units/undead-skeletal/skeleton/skeleton-se-melee2.png~RC(magenta>red)"
                {TUTOR: _"Skeletons are the bones of fallen warriors reanimated by dark sorcery. They are almost immune to <i>pierce</i> weapons like arrows and spears, but can be harmed by <i>blade</i> attacks like swords, and are especially vulnerable to <i>impact</i> weapons. Like bandits, they are much more dangerous at night!"}
            [/message]
        [/then]
    [/if]
[/event]

[event]
    name=attack
    [filter]
        type=Ghoul
    [/filter]
    [filter_second]
        side=1
    [/filter_second]
    {TUTORIAL_ENABLE_CONDITION}
    [if]
        [variable]
            name=sg_ghoul_info
            boolean_equals=no
        [/variable]
        [then]
            [set_variable]
                name=sg_ghoul_info
                value=yes
            [/set_variable]
            [message]
                speaker=narrator
                image="units/undead/ghoul-attack-3.png~RC(magenta>red)"
                {TUTOR: _"Ghouls are abominations of flesh with considerable durability and festering with disease. While their raw damage output is low, their <i>poison</i> attacks can cripple your units if you do not use your healers or villages effectively."}
            [/message]
        [/then]
    [/if]
[/event]

[event]
    name=attack
    [filter]
        type=Walking Corpse
    [/filter]
    [filter_second]
        side=1
    [/filter_second]
    {TUTORIAL_ENABLE_CONDITION}
    [if]
        [variable]
            name=sg_walking_corpse_info
            boolean_equals=no
        [/variable]
        [then]
            [set_variable]
                name=sg_walking_corpse_info
                value=yes
            [/set_variable]
            [message]
                speaker=narrator
                image="units/undead/zombie-attack-s.png~RC(magenta>red)"
                {TUTOR: _"Walking corpses are usually used by weaker practitioners of the black arts, who pilfer dead bodies to practice their profane magic. Alone, they are slow and weak, although they can become dangerous in large groups. Any unit slain by a Walking Corpse will be plagued with undeath and become one as well."}
            [/message]
        [/then]
    [/if]
[/event]

#define UNDO_REMINDER
    [if]
        [variable]
            name=undo_option
            equals=yes
        [/variable]
        [then]
            [message]
                speaker=narrator
                caption= _"Undo"
                image=wesnoth-icon.png
                message= _"Don’t forget, you can press <b>u</b> to undo most things if you make a mistake."
            [/message]

            [cancel_action] [/cancel_action]

            {CLEAR_VARIABLE undo_option}
        [/then]
    [/if]

    [allow_undo][/allow_undo]
#enddef

#define TALK_ABOUT ID_STRING MESSAGE_TEXT
    [scroll_to_unit]
        id={ID_STRING}
        highlight=yes
    [/scroll_to_unit]

    [message]
        speaker=Mari
        scroll=no
        highlight=no
        message={MESSAGE_TEXT}
    [/message]
#enddef

#define TALK_ABOUT_LOC POSITION MESSAGE_TEXT
    [scroll_to]
        x,y={POSITION}
        highlight=yes
    [/scroll_to]

    [message]
        speaker=Mari
        scroll=no
        highlight=no
        message={MESSAGE_TEXT}
    [/message]
#enddef

#define TSG_TUTORIAL_EVENTS_S1
###################################
# TODO: move some advanced topics elsewhere, focus on core topics related to ongoing events in scenario
###################################
    [event]
        name=side 1 turn 1
        {TUTORIAL_ENABLE_CONDITION}

        [message]
            speaker=narrator
            image=items/gohere.png
            {TUTOR: _"Whenever you see a target that looks like this, you should move onto the hex that contains it."}
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            [filter_location]
                terrain=*^V*
            [/filter_location]
        [/filter]
        {TUTORIAL_ENABLE_CONDITION}

        [message]
            speaker=Mari
            message= _"We have captured a village, which now flies the fabulously pretty colors of our banner. Villages provide the shiny gold <i>income</i> we need to <i>recruit</i> units. Villages will also <i>heal</i> any injured soldiers who stand on them for up to 8 hitpoints per turn. The house icon at the top of the screen shows our total village count."
        [/message]
        [message]
            speaker=Mari
            message= _"Hovering over a tile will show you the terrain type and whether or not it is a village in the terrain info box underneath the minimap."
        [/message]
        [allow_undo][/allow_undo]
    [/event]

    [event]
        name=moveto
        [filter_condition]
            [not]
                [have_unit]
                    side=1
                    formula="(self.moves=self.max_moves)"
                [/have_unit]
            [/not]
        [/filter_condition]
        {TUTORIAL_ENABLE_CONDITION}

        [message]
            speaker=narrator
            image=wesnoth-icon.png
            {TUTOR: _"End your turn whenever you are done moving all of your units."}
        [/message]
    [/event]

    [event]
        name=side 1 turn 1
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Objectives"
            message= _ "Each scenario has <b>objectives</b> that must be fulfilled in order to achieve victory as well as a list of defeat conditions. These can be found under <b>Objectives</b> in the <b>Menu</b> menu or by pressing <b>Ctrl+J</b>. A scenario may also have an early finish bonus and gold carryover, which allow you to gain and retain gold for future scenarios."
        [/hint_message]
    [/event]

    [event]
        name=turn 3
        {TUTORIAL_ENABLE_CONDITION}

        [message]
            speaker=Mari
            message= _ "By the way, bandits fight better at night, Deoran. If you want to be smart, you should hold the north bank of the river until dawn."
        [/message]

        [message]
            speaker=narrator
            image=misc/time-schedules/default/schedule-firstwatch.png
            {TUTOR: _"All of your units are <i>lawful</i>. This means that they receive a combat bonus during the day and a penalty at night. Urza Mathin’s units are all <i>chaotic</i>, which means that they receive a bonus at night and a penalty during the day. You will be much more effective fighting during the day."}
        [/message]

        [hint_message]
            caption= _ "Crowns"
            message= _ "The golden crown above your leaders (Captain Mari and Deoran) indicate that they are side leaders and can <i>recruit</i>. In most scenarios, you will lose if any of your leaders is killed. Be sure to keep them safe!"
        [/hint_message]
    [/event]

    #Recruiting help
    [event]
        name=moveto
        [filter]
            side=1
            x,y=9,10
        [/filter]
        {TUTORIAL_ENABLE_CONDITION}

        [message]
            speaker=Mari
            message= _"Deoran, we should recruit some more soldiers because I don’t feel like smashing these bandits all by myself. Whenever you or I are on a <i>keep</i>, we can <i>recruit</i> units on the castle tiles around it by right-clicking and selecting <b>Recruit</b> or by pressing <b>Ctrl+R</b>. We can also hover or select specific castle tiles to recruit on. However, newly recruited units are lazy and cannot act the turn we recruit them. We will only be able to use them next turn."
        [/message]
    [/event]

    #Traits help
    [event]
        name=recruit
        [filter]
            side=1
        [/filter]
        [filter_condition]
            [have_unit]
                side=1
                count=6
            [/have_unit]
        [/filter_condition]
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Traits"
            message= _"Be sure to examine the <i>traits</i> of your new recruits. They are listed under its race in the sidebar. Traits can subtly affect how you use your troops. For example, units with the <i>quick</i> trait can move an extra hex each turn, and units with the <i>intelligent</i> trait require 20% less experience to level up."
        [/hint_message]
    [/event]

    [event]
        name=turn 4
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Healing"
            message= _ "If a unit doesn’t do anything for a turn, it will heal 2 hitpoints. If the unit is on a village, it will also heal for up to 8 hitpoints, which can stack with the healing from resting."
        [/hint_message]
    [/event]

    [event]
        name=turn 5
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Zone of Control"
            message= _ "The hexes immediately around a unit constitute its <i>Zone of Control</i>. When an enemy unit enters those hexes, they cannot move any further that turn. This can be used to create a blockade to prevent stronger enemies from reaching key locations, such as villages, even if you have limited manpower. Level 0 units do not have a <i>Zone of Control</i>."
        [/hint_message]
    [/event]

    [event]
        name=turn 6
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Unit Descriptions"
            message= _ "You can right-click or press <b>d</b> on a unit to see a detailed <b>Unit Description</b>."
        [/hint_message]
    [/event]

    [event]
        name=turn 7
        {TUTORIAL_ENABLE_CONDITION}

        [message]
            speaker=narrator
            image=misc/time-schedules/default/schedule-dawn.png
            {TUTOR: _"During the day, your units will deal more damage and the bandits will deal less. The more of Urza Mathin’s troops you can defeat during the day, the better."}
        [/message]
    [/event]

    [event]
        name=turn 8
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Support"
            message= _"Each village you control will <i>support</i> one unit for free. After that, each unit costs you one gold per turn."
        [/hint_message]
    [/event]

    [event]
        name=turn 9
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Experience and Advancement"
            message= _ "Units gain experience from engaging in combat and defeating enemies. When a unit gains enough experience points (the <i>experience bar</i>, if present, is on the <b>right</b> of the <i>hitpoints bar</i>), it will gain a level. However, second level units cost twice as much to support as first level units."
        [/hint_message]
    [/event]

    [event]
        name=turn 10
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Protect Your Troops"
            message= _ "Remember to pull back wounded units into villages and recruit more if needed. Take special care of units with the highest <i>experience points (XP)</i> so they can gain levels and become more powerful."
        [/hint_message]
    [/event]

    [event]
        name=turn 11
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Defenses"
            message= _ "Whenever one of your units is selected, you’ll see varying percentages as you move the mouse over the map. The higher the percentage, the more <i>defense</i> that unit has in that kind of terrain. For example, most units have good defenses in castles and villages but poor defenses in rivers."
        [/hint_message]
    [/event]

    # Hint about attacking
    [event]
        name=moveto
        [filter]
            side=1
        [/filter]
        [filter_condition]
            [have_unit]
                side=2
                [filter_location]
                    x,y=$x1,$y1
                    radius=5
                [/filter_location]
            [/have_unit]
        [/filter_condition]
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _"Attacking"
            message= _"There are two main types of attacks in Wesnoth: <i>melee</i> and <i>ranged</i>. While both attack types can only be executed while adjacent to an enemy unit, units retaliate with the same type of attack (melee or ranged) as the attacking unit. Thus, units with only melee attacks cannot retaliate if a ranged attack is used against them. When you initiate an attack with an enemy unit (by clicking your unit and then the target), an attack description will pop up showing the expected retaliation from the enemy unit."
        [/hint_message]
    [/event]

    # Remind the player of the objective.
    [event]
        name=side 1 turn 1

        [set_variable]
            name=leader_attacked
            value=no
        [/set_variable]
    [/event]

    [event]
        name=attack
        [filter_second]
            id=Urza Mathin
        [/filter_second]
        [set_variable]
            name=leader_attacked
            value=yes
        [/set_variable]
    [/event]

    [event]
        name=turn 12
        {TUTORIAL_ENABLE_CONDITION}

        [if]
            [variable]
                name=leader_attacked
                boolean_not_equals=yes
            [/variable]
            [then]
                {TALK_ABOUT (Urza Mathin) ( _ "We should make that Urza Mathin our main target and defeat him before time runs out. Archers will be especially effective against him because he has no ranged attack.")}
            [/then]
        [/if]
    [/event]

    [event]
        name=victory

        {CLEAR_VARIABLE leader_attacked}
    [/event]

    [event]
        name=victory
        {TUTORIAL_ENABLE_CONDITION}

        [message]
            speaker=narrator
            image=wesnoth-icon.png
            {TUTOR: _"You have completed all the <i>objectives</i> for this scenario and achieved victory. You will now see a pop-up detailing your <i>early finish bonus</i>, a gold bonus for finishing the scenario before the turn limit, and <i>gold carryover</i>, the amount of extra gold you will start the next scenario with. When you are done reading these, press the <b>End Scenario</b> button or <b>Ctrl+Space</b> to continue to the next scenario."}
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            [filter_location]
                x,y=15,19
                radius=4
            [/filter_location]
        [/filter]
        {TUTORIAL_ENABLE_CONDITION}

        {TALK_ABOUT (Urza Mathin) ( _ "Urza Mathin is a <i>level 2</i> unit and is stronger than the <i>level 1</i> units that he commands. We should attack him with ranged units during the day unless you really enjoy getting clubbed.")}

        {UNDO_REMINDER}
    [/event]
#enddef

#define TSG_TUTORIAL_EVENTS_S1x
    [event]
        name=start
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            message= _ "Captain Mari and Deoran have unrestricted movement in this scenario. End your turn to continue on to the next scenario."
        [/hint_message]
    [/event]
#enddef

#define TSG_TUTORIAL_EVENTS_S2
###################################
# TODO: add loyal trait explanations, shuffle around healing explanations
###################################
    [event]
        name=start
        {TUTORIAL_ENABLE_CONDITION}

        {VARIABLE lhpu_msg_i 0}

        {VARIABLE low_hp_unit_message[0].value ( _ "I hope I have a chance to retreat after this!")}
        {VARIABLE low_hp_unit_message[1].value ( _ "One unlucky round of attacks and I’m done for!")}
        {VARIABLE low_hp_unit_message[2].value ( _ "I could make use of some healing in a village.")}
        {VARIABLE low_hp_unit_message[3].value ( _ "I had better retreat, before I get caught out with such low health!")}

        [message]
            speaker=Mari
            message= _"Deoran, either you or I must move to the center of the elvish citadel. We should <i>recruit</i> or <i>recall</i> a force strong enough to drive off the bandits before leaving our encampment."
        [/message]

        [hint_message]
            caption= _ "Recalling"
            message= _ "In addition to recruiting new units each scenario, you can also <i>recall</i> your experienced veterans from previous scenarios. By default, no matter the level of your veterain, recalling only costs 20 gold. This allows you to build up a formidable army over the course of multiple scenarios by recalling your highest leveled troops or those with good combinations of traits and abilities. To recall a unit, right-click while your leader stands on a keep and select the <i>Recall</i> option, or use the hotkey <b>Alt+R</b>."
        [/hint_message]
    [/event]

    [event]
        name=select
        [filter]
            id=Minister Hylas
        [/filter]

        [message]
            speaker=narrator
            image="units/human-magi/white-mage-magic-1.png~RC(magenta>red)"
            {TUTOR: _"Minister Hylas heals adjacent allied units at the start of each turn for 8 hitpoints. However, he does not gain experience from healing. As a white mage, his <i>arcane</i> attack deals bonus damage to undead foes."}
        [/message]
    [/event]

    [event]
        name=select
        [filter]
            id=Sir Gerrick
        [/filter]

        [message]
            speaker=narrator
            image="units/infantry-commander.png~RC(magenta>red)"
            {TUTOR: _"As a senior infantry officer, Sir Gerrick is both a powerful warrior and can sustain a significant amount of damage on the front line."}
        [/message]
    [/event]

    [event]
        name=turn 2
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Weapon Specials"
            message= _ "Weapon specials are special attack modifiers that make certain attacks more powerful. Spearmen have the <i>first strike</i> special on their melee attacks, allowing them to always hit first in melee combat no matter who attacks first. Other weapon specials include the <i>magical</i> special, which gives an attack a constant 70% chance to hit, and <i>charge</i>, which doubles both damage dealt and taken on offense.

A full list of abilities and weapon specials, along with traits, may be found in the help (default hotkey: <b>F1</b>)."
        [/hint_message]
    [/event]

    [event]
        name=turn 3
        {TUTORIAL_ENABLE_CONDITION}

        [message]
            speaker=narrator
            image="units/merfolk/hunter.png~RC(magenta>red)"
            {TUTOR: _"You may now recruit Merman Hunters. Merfolk are aquatic creatures and fight best in rivers and swamps, but are much less effective on dry land. Their hunters are stronger with <i>ranged</i> attacks and are weaker in <i>melee</i> combat."}
        [/message]

        [hint_message]
            caption= _ "Income and Upkeep"
            message= _ "Each turn, you will gain 2 gold plus one for each village you own. However, <i>upkeep</i> is subtracted from that. You can support as many levels worth of units as the number of villages you own; beyond that, you must pay 1 gold per turn. Be careful, as owning too many units can cause you to have negative income and lose gold each turn!"
        [/hint_message]
    [/event]

    [event]
        name=turn 4
        {TUTORIAL_ENABLE_CONDITION}

        {TALK_ABOUT_LOC 21,21 ( _ "Deoran, do you see this dark blue water? It’s too deep for land units to cross. We should send units around to the lighter blue shallow water or ford to strike at the bandits from behind their encampment. Alternatively, we can use our new merfolk allies to attack the bandits from the water. We should avoid putting our land-based units in water, unless you deliberately enjoy employing bad strategies.")}

        [hint_message]
            message= _ "When moving a unit, the percentages shown are the unit’s defense on that hex. The higher the number, the less likely they are to get hit."
        [/hint_message]
    [/event]

    [event]
        name=turn 5
        {TUTORIAL_ENABLE_CONDITION}

        [message]
            speaker=Mari
            message= _ "It is daytime again. Deoran, let me remind you that our units are <i>lawful</i>: their attacks are 25% stronger by day and 25% weaker at night. The bandits are <i>chaotic</i>: weaker during the day and stronger during the night. We should defeat as many of them as we can before the sun sets."
        [/message]

        [hint_message]
            caption= _ "Time of Day"
            message= _ "During a scenario, the time of day will shift as turns pass. There are four <i>alignments</i> a unit may be: Lawful, Neutral, Chaotic, or Liminal. Each alignment gets a different bonus or handicap depending on the time of day. You can hover over the sky image below the minimap on the right to see the current time of day and who has the advantage."
        [/hint_message]
    [/event]

    [event]
        name=turn 6
        {TUTORIAL_ENABLE_CONDITION}

        [message]
            speaker=Mari
            message= _ "We should retreat wounded units to villages, which can heal them for 8 hitpoints per turn. Think of their poor families, you wouldn’t want them to die needlessly, would you?"
        [/message]
    [/event]

    [event]
        name=turn 7
        {TUTORIAL_ENABLE_CONDITION}

        [message]
            speaker=Mari
            message= _ "Night is coming. We should be careful, as our enemies will start doing increased damage next turn."
        [/message]
    [/event]

    [event]
        name=turn 8
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Tracking Enemy Movement"
            message= _ "You can see where an enemy can reach by moving the mouse over them. You can see all possible enemy moves at once with the <b>Show Enemy Moves</b> command from the <b>Actions</b> menu."
        [/hint_message]
    [/event]

    [event]
        name=turn 9
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Long-distance Movement"
            message= _ "You can order a unit to move for multiple turns by selecting the unit and clicking on the destination. A number will indicate how many turns it will take to get there."
        [/hint_message]
    [/event]

    [event]
        name=turn 11
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Tracking Unused Units"
            message= _ "You can ensure you use all your troops by pressing <b>n</b> to step from one unit to the next. If you press <b>space</b>, you can mark the currently selected unit as having finished its turn, which stops you moving it by accident later on. When <b>n</b> no longer selects a new unit, it’s safe to end your turn."
        [/hint_message]
    [/event]

    [event]
        name=turn 13
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Status Table"
            message= _ "The Status Table details the sides’ current status and starting conditions. Fog and shroud will affect what you can see in this table, and occasionally a side may be hidden; however, it is still useful to check this table when a scenario begins. You can access it in the <b>Menu</b> menu."
        [/hint_message]
    [/event]

    [event]
        name=turn 15
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Speeding Up Animations"
            message= _ "Holding down <b>shift</b> will make the animations for moving and fighting quicker. Acceleration can also be toggled on or off using <b>Ctrl+A</b> The <b>acceleration factor</b> can be set, and turned on by default, in the <b>Preferences</b> menu’s <b>General</b> tab."
        [/hint_message]
    [/event]

    [event]
        name=turn 16
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Victory Conditions"
            message= _ "In this scenario, you must move either Captain Mari or Deoran to the marker at 11,7 to win. Though it may be useful, defeating Urza Fastik will not win you the scenario. Victory conditions for a scenario are given under <b>Objectives</b> in the <b>Menu</b> menu."
        [/hint_message]
    [/event]

    [event]
        name=capture
        [filter]
            side=2
        [/filter]
        {TUTORIAL_ENABLE_CONDITION}

        {TALK_ABOUT_LOC ($x1,$y1) ( _ "That unit has captured a village. Villages heal units each turn and provide good defense, so we should be careful around it.")}
    [/event]

    [event]
        name=warn_about_units_with_low_health
        first_time_only=no
        [filter_condition]
            [variable]
                name=unit.hitpoints
                less_than="$($unit.max_hitpoints/5)"
            [/variable]
            [variable]
                name=unit.hitpoints
                greater_than=0
            [/variable]
            [variable]
                name=second_unit.hitpoints
                greater_than=0
            [/variable]

            [variable]
                name=lhpu_msg_i
                less_than_equal_to=3
            [/variable]
        [/filter_condition]
        {TUTORIAL_ENABLE_CONDITION}

        [message]
            speaker=unit
            message="$low_hp_unit_message[$lhpu_msg_i].value"
        [/message]

        {VARIABLE_OP lhpu_msg_i add 1}

        [message]
            speaker=Mari
            message= _ "That unit is about one kill (8 experience points) away from gaining a level. Protect him so he can level up."
            [show_if]
                [variable]
                    name=unit.experience
                    greater_than=$($unit.max_experience - 8)
                [/variable]
            [/show_if]
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            [filter_location]
                terrain=Ww,Ww^*
            [/filter_location]
            [not]
                race=merman
            [/not]
            side=1
        [/filter]
        {TUTORIAL_ENABLE_CONDITION}

        [message]
            speaker=Mari
            scroll=no
            message= _ "It’s very dangerous to stand in water when there are enemies about. Our land units will have an 80% chance of being hit. We should stay on land and wait for them to come to us."
        [/message]

        {UNDO_REMINDER}

        # cancel an eventually started attack to still allow undoing after the warning
        [cancel_action][/cancel_action]
    [/event]

    #Advancements
    [event]
        name=post_advance
        [filter]
            side=1
            type=Swordsman
        [/filter]
        {TUTORIAL_ENABLE_CONDITION}

        [message]
            speaker=unit
            message= _ "Advancing a level has fully healed me! I am particularly good with the sword, dealing 8 damage in 4 attacks."
        [/message]
    [/event]

    [event]
        name=post_advance
        [filter]
            side=1
            type=Pikeman
        [/filter]
        {TUTORIAL_ENABLE_CONDITION}

        [message]
            speaker=unit
            message= _ "Advancing a level has fully healed me! I now have a powerful pike attack, dealing 10 damage in 3 attacks and having the <i>firststrike</i> weapon special."
        [/message]
    [/event]

    [event]
        name=post_advance
        [filter]
            side=1
            type=Javelineer
        [/filter]
        {TUTORIAL_ENABLE_CONDITION}

        [message]
            speaker=unit
            message= _ "Advancing a level has fully healed me! While I can no longer advance any further, I have both powerful melee and ranged attacks and am a versatile mixed fighter in combat. If I gain enough experience, instead of advancing, I will fully heal again and gain maximum hitpoints."
        [/message]
    [/event]

    [event]
        name=post_advance
        [filter]
            side=1
            type=Longbowman
        [/filter]
        {TUTORIAL_ENABLE_CONDITION}

        [message]
            speaker=unit
            message= _ "Advancing a level has fully healed me! I have a powerful ranged bow attack, dealing 10 damage in 3 attacks."
        [/message]
    [/event]

    [event]
        name=attack_end
        [filter_second]
            side=1
            level=2,3
        [/filter_second]
        [filter_condition]
            [variable]
                name=second_unit.hitpoints
                less_than=21
            [/variable]
        [/filter_condition]
        {TUTORIAL_ENABLE_CONDITION}

        [fire_event]
            name=veteran_warning
        [/fire_event]
    [/event]

    [event]
        name=die
        [filter_second]
            side=1
            level=2,3
        [/filter_second]
        {TUTORIAL_ENABLE_CONDITION}

        [fire_event]
            name=veteran_warning
        [/fire_event]
    [/event]

    [event]
        name=veteran_warning

        [message]
            speaker=Mari
            message= _ "Veterans are powerful additions to our army and we should avoid losing them whenever possible."
        [/message]
    [/event]

    [event]
        name=victory

        {CLEAR_VARIABLE lhpu_msg_i,low_hp_unit_message}
    [/event]
#enddef

#define TSG_TUTORIAL_EVENTS_S3
    [event]
        name=start
        {TUTORIAL_ENABLE_CONDITION}

        [message]
            speaker=Mari
            message= _"If you have eyeballs, I am sure you can tell this thick fog is preventing us from seeing further into the valley. Despite it supposedly being peaceful here, we should take caution as we do not know what may lie behind the fog of war. We probably should recruit a few units just to be prepared."
        [/message]
    [/event]

    [event]
        name=side 1 turn 1
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Fog of War"
            message= _ "This scenario has fog of war, which hides units and ownership of villages outside of your units’ vision. Fog of war is cleared temporarily when you have units nearby, but returns when they leave. Your unit’s movement will be stopped if it sees an enemy unit in the fog of war. Clearing fog of war will prevent you from undoing actions unless you activate <b>Delay Shroud Updates</b> in the actions menu, which prevents units from clearing fog until the next randomized event or turn."
        [/hint_message]
    [/event]

    [event]
        name=select
        [filter]
            id=Ethiliel
        [/filter]
        {TUTORIAL_ENABLE_CONDITION}

        [message]
            speaker=narrator
            image="units/elves-wood/shyde-healing4.png~RC(magenta>green)"
            {TUTOR: _"Ethiliel is a powerful <i>level 3</i> Elvish Shyde capable of healing allied units at the start of every turn. She has powerful ranged attacks: a mighty <i>magical</i> thorns attack and an ensnare attack that <i>slows</i> enemy units, halving their movement and damage dealt. She also has a <i>flying</i> movetype, offering excellent defenses and movement over most terrain and the ability to cross <i>deep water</i>."}
        [/message]
    [/event]

    [event]
        name=turn 2
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Recruiting"
            message= _ "You can recruit or recall from any keep with attached castle tiles, including those your leader did not start on. If you capture an enemy keep, you can prevent them from using it to recruit."
        [/hint_message]
    [/event]

    [event]
        name=turn 3
        {TUTORIAL_ENABLE_CONDITION}

        [message]
            speaker=Mari
            message= _ "Excellent. Deoran, we can now recruit Cavalrymen. They are fast and deadly on grassland, but weak in forests and unable to traverse mountains. They will be useful for scouting through this fog."
        [/message]
    [/event]

    [event]
        name=turn 4
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Victory Conditions"
            message= _ "Each scenario has different victory conditions, which must be read carefully in order to achieve victory. In this case, in addition to moving to Ethiliel to the marker at (25,28), you must defeat all enemies on the map. This includes finding where they may be hidden in the fog of war."
        [/hint_message]
    [/event]

    [event]
        name=turn 5
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Scouting"
            message= _ "Units with higher movement points such as <i>Cavalrymen</i> or <i>Dragoons</i> can see further into fog of war. They can provide valuable information about the state of the map and where enemies may be lying in wait. Units with flying movetypes, such as Ethiliel, are also useful for scouting."
        [/hint_message]
    [/event]

    [event]
        name=turn 7
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Battle Formation Strategy"
            message= _ "The bandits are scattered around the map and weak individually. You can take advantage of this by keeping your units together in formation. By traveling together and making use of abilities like Mari’s <i>protection</i> or Ethiliel’s <i>heals</i>, you can easily overcome the enemy."
        [/hint_message]
    [/event]

    [event]
        name=turn 9
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Unit Level Cap"
            message= _ "Units have a maximum level they can reach (often level 3), after which they will no longer advance when gaining enough experience. Instead, they will achieve an <i>After Maximum Level Advancement (AMLA)</i>. In many campaigns, this raises the maximum hitpoints by 3 and fully heals the unit, at the cost of increasing their maximum experience. However, this is not a universal default and some campaigns may offer other options."
        [/hint_message]
    [/event]

    [event]
        name=turn 11
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Distributing Experience"
            message= _ "In many cases, it is a useful strategy to focus experience onto a couple lower level units in order to advance them to the next level. Once you have enough veterans, you can pair them with fresh recruits and use the veteran to do the bulk of the damage, allowing the new recruit to obtain the last hit to gain it more experience. This can minimize the damage to your army and the losses you take."
        [/hint_message]
    [/event]

    [event]
        name=turn 13
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Keeping Heroes Safe"
            message= _ "Minimizing the risk to your heroes (e.g. Captain Mari or Officer Deoran) is important, as the campaign will be lost if one of them die. However, if they do not obtain enough experience, they will also be too weak to be effective in later scenarios. Striking a balance of minimizing risk and obtaining adequate experrience is important to utilizing your heroes effectively."
        [/hint_message]
    [/event]

    [event]
        name=turn 15
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Early Finish Bonus"
            message= _ "Many scenarios with turn limits offer an early finish bonus, which is a gold bonus greater than the possible income you could obtain from the scenario. However, it is not always beneficial to finish a scenario early if there are remaining enemies you can obtain experience from."
        [/hint_message]
    [/event]

    [event]
        name=turn 17
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            remove=yes
        [/hint_message]
    [/event]
#enddef

#define TSG_TUTORIAL_EVENTS_S4
    [event]
        name=side 1 turn 1
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Shroud"
            message= _ "This scenario has shroud in addition to fog of war. Shroud hides the map and all of its terrain features, but is cleared permanently as your units explore more of the map. Like with fog of war, scouts are particularly effective at exploration and clearing shroud."
        [/hint_message]
    [/event]

    [event]
        name=turn 2
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Safe Shroud Exploration"
            message= _ "Unlike scenarios with only fog of war, you do not know if there will be another opportunity to recruit or recall units in other areas of the map. It may be prudent to first recruit expeditionary forces and begin scouting before moving your leaders away from the starting keep."
        [/hint_message]
    [/event]

    [event]
        name=turn 4
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Using Elves"
            message= _ "You have now gained command of some elvish units. Compared to humans, they have higher defenses and better movement in forest. Elves also have the <i>neutral</i> alignment, meaning that they are unaffected by and fight equally well during all times of day. The number of elven units you have access to is limited, so be sure to protect them and use them wisely."
        [/hint_message]
    [/event]

    [event]
        name=turn 6
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Multiple Healers"
            message= _ "You now have two healers. However, each unit can only receive healing from one healing source: even when standing next to Ethiliel and a druid, a unit will only be healed by 8 hitpoints per turn.

In general, a unit next to multiple healers or standing on a village is healed by the most advanced source of healing."
        [/hint_message]
    [/event]

    [event]
        name=turn 8
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Income Strategy"
            message= _ "Seeking out and capturing villages is not only important to supporting your own forces, but also to denying enemy income. If the enemy seems to constantly be recruiting and you are unable to make progress, consider trying to capture some of their villages to deny their source of gold."
        [/hint_message]
    [/event]

    [event]
        name=turn 10
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            remove=yes
        [/hint_message]
    [/event]

    [event]
        name=turn 12
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "The Danger of Poison"
            message= _ "Any units that are <i>poisoned</i> continuously lose hitpoints, even when not in direct combat with enemies. Take care not to let enemies spread poison among multiple units and make sure to keep your healers safe: Ethiliel can minimize the damage you take from poison as long as you position her properly."
        [/hint_message]
    [/event]

    [event]
        name=turn 14
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            remove=yes
        [/hint_message]
    [/event]

    [event]
        name=turn 15
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Fighting in Enemy Bases"
            message= _ "Assaulting an enemy castle can be difficult due to its improved defenses, as well as the fresh reinforcements that may be recruited close to the battle. Some strategies for effectively fighting an enemy in their own base are denying their villages to cut off their income, luring their units off castle hexes, and occupying the castle hexes with your own units. If their leader moves off their keep to fight or heal, you can also seize the opportunity to capture the keep for yourself!"
        [/hint_message]
    [/event]

    [event]
        name=turn 17
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Retreating and Reengaging"
            message= _ "Just because you have begun to fight the enemy does not mean you must continuously do so. Should the time of day become unfavorable or should they gain reinforcements, it may be wise to retreat temporarily to regather your forces and fight them on terrain that is more advantageous to you. You can also retreat to heal wounded units and reengage once they have recovered."
        [/hint_message]
    [/event]

    [event]
        name=turn 19
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Multiple Enemy Sides"
            message= _ "A scenario may have multiple enemy sides, who may or may not be aligned with one another. If you notice enemies begin to fight one another, you can use this to your advantage by letting them weaken each others’ forces before moving in to finish both off."
        [/hint_message]
    [/event]

    [event]
        name=turn 20
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            remove=yes
        [/hint_message]
    [/event]

    [event]
        name=turn 22
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Strategy Around Chokepoints"
            message= _ "Chokepoints are areas where there are one or two hex-wide paths of favorable terrain, such as a bridge over water, or a narrow path between castle hexes. At a chokepoint, you can easily hold an enemy back by occupying the terrains with high defenses and forcing them onto the hexes where they will have lower defenses."
        [/hint_message]
    [/event]

    [event]
        name=turn 24
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Strategy Around Chokepoints"
            message= _ "Enemies can also prevent you from advancing at chokepoints by limiting the number of units that can engage in a single turn. Use the chokepoint to your advantage if you are getting overwhelmed from multiple directions, or avoid it if you are getting bogged down and getting close to the turn limit."
        [/hint_message]
    [/event]

    [event]
        name=turn 27
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            remove=yes
        [/hint_message]
    [/event]

    [event]
        name=sighted
        [filter]
            id="Mal M'Brin"
        [/filter]
        {TUTORIAL_ENABLE_CONDITION}

        {TALK_ABOUT (Mal M'Brin) ( _ "That corrupted sage is a powerful level 3 unit, with particularly dangerous ranged <i>magical</i> attacks. We should engage him carefully and avoid placing low health units close to him. We better wait until daytime to attack him, when he is much weaker.")}
    [/event]

    [event]
        name=attack_end
        [filter]
            side=1
        [/filter]
        [filter_second]
            type_adv_tree=Skeleton,Skeleton Archer
        [/filter_second]
        {TUTORIAL_ENABLE_CONDITION}

        [message]
            speaker=Deoran
            message= _ "Our weapons are ineffective against these skeletons! What should we do?"
        [/message]

        [message]
            speaker=Mari
            message= _ "These skeletons are resistant to <i>pierce</i> attacks, but less resilient against <i>blade</i> attacks, and particularly vulnerable to <i>impact</i> attacks. We should prioritize using units with <i>blade</i> or <i>impact</i> attacks."
        [/message]
    [/event]
#enddef

#define TSG_TUTORIAL_EVENTS_S5
    [event]
        name=side 1 turn 1
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Scenario Specific Mechanics"
            message= _ "Some scenarios have mechanics that are specific to that scenario alone. In this scenario, Ethiliel has the ability to reveal flat terrain through the otherwise dense forest in front of you as long as she is close to the existing path. This mechanic is also explained in the <i>notes</i> section of the <i>objectives</i>. Use this mechanic to hasten your path toward the <i>victory condition</i>, which is to reach the northern bank of the river."
        [/hint_message]
    [/event]

    [event]
        name=turn 4

        [hint_message]
            remove=yes
        [/hint_message]
    [/event]

    [event]
        name=turn 6
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Ambush"
            message= _ "Some units have abilities that hide them from view under certain conditions. Enemy elves on this map have <i>ambush</i>, which hides them in forest until one of your units moves adjacent to them. The unit that discovers the ambusher will reveal the ambusher but lose all of its remaining movement."
        [/hint_message]
    [/event]

    [event]
        name=turn 8
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Strategy Against Hidden Units"
            message= _ "Against <i>ambushers</i> or other units with abilities that hide them, it is important to keep your units close together and protect your most vulnerable units in the middle of the group. Use <i>zone of control</i> and travel in groups to prevent ambushers from targeting low health units."
        [/hint_message]
    [/event]

    [event]
        name=turn 9
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Strategy Against Hidden Units Part II"
            message= _ "In this scenario, all <i>ambushers</i> will not become active until you reveal them. However, in other campaigns, enemy units may actively seek to assault you even while hidden. It is important to keep track of what conditions the enemy unit may be hidden, as well as how many units have that ability. This will allow you to prepare for them properly."
        [/hint_message]
    [/event]

    [event]
        name=turn 11
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Protecting Healers"
            message= _ "The health of your healers is especially important; so long as they can remain close to the front of the battle, they can continuously help your other units recuperate damage. If you have multiple healers, placing them next to one another can help protect them. Using <i>zone of control</i> to prevent enemy units from reaching your healers is also important to keeping them safe."
        [/hint_message]
    [/event]

    [event]
        name=turn 13
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Victory Conditions"
            message= _ "In scenarios where victory conditions are not to defeat the enemy, it is important to keep an eye on progress toward the objective. Strike a balance between gaining experience from enemy units while progressing toward the victory condition by the turn limit. Avoid pursuing enemy units when assaulting them would put you in a bad position or if you are behind on progress in the scenario."
        [/hint_message]
    [/event]

    [event]
        name=turn 14
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            remove=yes
        [/hint_message]
    [/event]
#enddef

#define TSG_TUTORIAL_EVENTS_S6
    [event]
        name=turn 2
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            caption= _ "Victory Conditions"
            message= _ "In this scenario, the victory condition is simply to survive until the end of turns (without otherwise being defeated). In these types of scenarios, it may be more prudent to play defensively and hold terrain where you have an advantageous position. Do not be afraid to retreat if the situation demands it."
        [/hint_message]
    [/event]
    [event]
        name=turn 4
        {TUTORIAL_ENABLE_CONDITION}

        [hint_message]
            remove=yes
        [/hint_message]

        [message]
            speaker=Mari
            message= _"Deoran, we need units that are good on defense and at holding positions. We should consider using more regular infantry, who have higher defenses on castle tiles compared to cavalry. Scouting is not important for this mission. We can also now recruit <i>Heavy Infantrymen</i>, who have lower movement but improved resistances compared to <i>Spearmen</i> or <i>Bowmen</i>. <i>Heavy Infantrymen</i> are especially good at holding castle terrain."
        [/message]
    [/event]
#enddef
